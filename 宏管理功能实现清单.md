# å®ç®¡ç†åŠŸèƒ½å®ç°æ¸…å•

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ•°æ®åº“å±‚ âœ…
- [x] `sys_baseband_macro` å®å®šä¹‰è¡¨
- [x] `sys_baseband_macro_param` å®å‚æ•°å€¼è¡¨
- [x] ç¤ºä¾‹æ•°æ®æ’å…¥
- [x] èœå•æƒé™SQL
- [x] éƒ¨ç½²è„šæœ¬ `deploy_macro.bat`

**æ–‡ä»¶ä½ç½®**ï¼š
- `RuoYi-Vue/sql/baseband_macro.sql`
- `RuoYi-Vue/sql/add_macro_menu.sql`
- `RuoYi-Vue/sql/deploy_macro.bat`

### 2. åç«¯ä»£ç  âœ…
- [x] å®ä½“ç±» `SysBasebandMacro.java`
- [x] Mapperæ¥å£ `SysBasebandMacroMapper.java`
- [x] Mapper XML `SysBasebandMacroMapper.xml`
- [x] Serviceæ¥å£ `ISysBasebandMacroService.java`
- [x] Serviceå®ç° `SysBasebandMacroServiceImpl.java`
- [x] Controller `SysBasebandMacroController.java`

**æ–‡ä»¶ä½ç½®**ï¼š
- `RuoYi-Vue/ruoyi-system/src/main/java/com/ruoyi/system/domain/`
- `RuoYi-Vue/ruoyi-system/src/main/java/com/ruoyi/system/mapper/`
- `RuoYi-Vue/ruoyi-system/src/main/resources/mapper/system/`
- `RuoYi-Vue/ruoyi-system/src/main/java/com/ruoyi/system/service/`
- `RuoYi-Vue/ruoyi-admin/src/main/java/com/ruoyi/web/controller/system/`

### 3. å‰ç«¯ä»£ç  âœ…
- [x] å®ç®¡ç†ä¸»é¡µé¢ `macro/index.vue`
- [x] APIæ¥å£ `macro.js`
- [x] å®åˆ—è¡¨å±•ç¤º
- [x] å®å¢åˆ æ”¹æŸ¥
- [x] å®å‚æ•°é…ç½®å¯¹è¯æ¡†
- [x] å‚æ•°é€‰æ‹©å¯¹è¯æ¡†

**æ–‡ä»¶ä½ç½®**ï¼š
- `RuoYi-Vue3/src/views/system/baseband/macro/index.vue`
- `RuoYi-Vue3/src/api/system/baseband/macro.js`

### 4. æ–‡æ¡£ âœ…
- [x] è¯¦ç»†è®¾è®¡æ–‡æ¡£ `å®ç®¡ç†åŠŸèƒ½è®¾è®¡æ–‡æ¡£.md`
- [x] å¿«é€Ÿä½¿ç”¨æŒ‡å— `å®ç®¡ç†å¿«é€Ÿä½¿ç”¨æŒ‡å—.md`
- [x] å®ç°æ¸…å• `å®ç®¡ç†åŠŸèƒ½å®ç°æ¸…å•.md`

## â³ å¾…å®Œå–„çš„åŠŸèƒ½

### 1. å®å‚æ•°ç®¡ç†ï¼ˆéœ€è¦å®Œå–„ï¼‰
**å½“å‰çŠ¶æ€**ï¼šæ¡†æ¶å·²æ­å»ºï¼Œéœ€è¦å®ç°å…·ä½“é€»è¾‘

**å¾…å®ç°**ï¼š
- [ ] `getMacroParams()` - æŸ¥è¯¢å®çš„å‚æ•°é…ç½®
- [ ] `saveMacroParams()` - ä¿å­˜å®çš„å‚æ•°é…ç½®
- [ ] åˆ é™¤å®æ—¶çº§è”åˆ é™¤å‚æ•°é…ç½®

**å®ç°ä½ç½®**ï¼š
- `SysBasebandMacroServiceImpl.java`

**å®ç°å»ºè®®**ï¼š
```java
// 1. åˆ›å»ºå®å‚æ•°Mapper
public interface SysBasebandMacroParamMapper {
    List<Map<String, Object>> selectMacroParams(Long macroId);
    int deleteMacroParamsByMacroId(Long macroId);
    int insertMacroParam(Map<String, Object> param);
}

// 2. åœ¨Serviceä¸­å®ç°
@Override
public List<Map<String, Object>> getMacroParams(Long macroId) {
    // æŸ¥è¯¢å®å‚æ•°ï¼Œå…³è”å‚æ•°å®šä¹‰è¡¨è·å–å®Œæ•´ä¿¡æ¯
    return macroParamMapper.selectMacroParams(macroId);
}

@Override
@Transactional
public int saveMacroParams(Long macroId, List<Map<String, Object>> params) {
    // 1. åˆ é™¤æ—§å‚æ•°
    macroParamMapper.deleteMacroParamsByMacroId(macroId);
    // 2. æ‰¹é‡æ’å…¥æ–°å‚æ•°
    for (Map<String, Object> param : params) {
        param.put("macroId", macroId);
        macroParamMapper.insertMacroParam(param);
    }
    return 1;
}
```

### 2. åŸºå¸¦å•å…ƒåˆ›å»ºé›†æˆï¼ˆéœ€è¦å®ç°ï¼‰
**å½“å‰çŠ¶æ€**ï¼šæœªå®ç°

**å¾…å®ç°**ï¼š
- [ ] åœ¨å•å…ƒåˆ›å»ºå¯¹è¯æ¡†æ·»åŠ å®é€‰æ‹©ä¸‹æ‹‰æ¡†
- [ ] æ ¹æ®å•å…ƒç±»å‹å’Œæ¨¡å¼ç±»å‹åŠ è½½å¯ç”¨å®
- [ ] åˆ›å»ºå•å…ƒæ—¶åº”ç”¨å®å‚æ•°
- [ ] è‡ªåŠ¨ä¸‹å‘å‚æ•°åˆ°ç¡¬ä»¶

**å®ç°ä½ç½®**ï¼š
- `RuoYi-Vue3/src/views/system/baseband/unit/index.vue`
- `RuoYi-Vue/ruoyi-admin/.../SysBasebandUnitController.java`

**å®ç°æ­¥éª¤**ï¼š

#### å‰ç«¯ä¿®æ”¹
```vue
<!-- åœ¨å•å…ƒåˆ›å»ºå¯¹è¯æ¡†ä¸­æ·»åŠ  -->
<el-form-item label="åº”ç”¨å®é…ç½®" prop="macroId">
  <el-select v-model="form.macroId" placeholder="è¯·é€‰æ‹©å®é…ç½®" clearable>
    <el-option
      v-for="macro in availableMacros"
      :key="macro.macroId"
      :label="macro.macroName"
      :value="macro.macroId"
    />
  </el-select>
  <div class="el-form-item-msg" v-if="selectedMacro">
    å°†è‡ªåŠ¨åº”ç”¨ {{ selectedMacro.paramCount }} ä¸ªé¢„è®¾å‚æ•°
  </div>
</el-form-item>

<el-form-item label="è‡ªåŠ¨ä¸‹å‘" prop="autoDispatch">
  <el-checkbox v-model="form.autoDispatch">
    åˆ›å»ºåç«‹å³ä¸‹å‘å‚æ•°åˆ°ç¡¬ä»¶
  </el-checkbox>
</el-form-item>

<script>
// ç›‘å¬å•å…ƒç±»å‹å’Œæ¨¡å¼ç±»å‹å˜åŒ–ï¼ŒåŠ è½½å¯ç”¨å®
watch([() => form.value.unitType, () => form.value.modeType], ([unitType, modeType]) => {
  if (unitType) {
    getAvailableMacros(unitType, modeType).then(response => {
      availableMacros.value = response.data
      // è‡ªåŠ¨é€‰ä¸­é»˜è®¤å®
      const defaultMacro = availableMacros.value.find(m => m.isDefault === '1')
      if (defaultMacro) {
        form.value.macroId = defaultMacro.macroId
      }
    })
  }
})
</script>
```

#### åç«¯ä¿®æ”¹
```java
// åˆ›å»ºå•å…ƒå¹¶åº”ç”¨å®
@PostMapping("/createWithMacro")
public AjaxResult createWithMacro(@RequestBody Map<String, Object> params) {
    // 1. åˆ›å»ºå•å…ƒ
    SysBasebandUnit unit = new SysBasebandUnit();
    // ... è®¾ç½®å•å…ƒå±æ€§
    basebandUnitService.insertSysBasebandUnit(unit);
    
    // 2. å¦‚æœæŒ‡å®šäº†å®ï¼Œåº”ç”¨å®å‚æ•°
    Long macroId = (Long) params.get("macroId");
    if (macroId != null) {
        List<Map<String, Object>> macroParams = macroService.getMacroParams(macroId);
        for (Map<String, Object> param : macroParams) {
            SysBasebandParamValue value = new SysBasebandParamValue();
            value.setUnitId(unit.getUnitId());
            value.setParamId((Long) param.get("paramId"));
            value.setRawValue((String) param.get("paramValue"));
            // ... è®¡ç®—uint_value
            paramValueService.insertSysBasebandParamValue(value);
        }
        
        // 3. å¦‚æœéœ€è¦è‡ªåŠ¨ä¸‹å‘
        Boolean autoDispatch = (Boolean) params.get("autoDispatch");
        if (autoDispatch != null && autoDispatch) {
            // è°ƒç”¨ä¸‹å‘æ¥å£
            dispatchService.dispatchParams(unit.getUnitId());
        }
    }
    
    return success(unit);
}
```

### 3. å‚æ•°ä¸‹å‘åŠŸèƒ½ï¼ˆéœ€è¦å®ç°ï¼‰
**å½“å‰çŠ¶æ€**ï¼šæœªå®ç°

**å¾…å®ç°**ï¼š
- [ ] å‚æ•°ä¸‹å‘æ¥å£
- [ ] ç»„æ’­å‘é€é€»è¾‘
- [ ] ä¸‹å‘æ—¥å¿—è®°å½•
- [ ] ä¸‹å‘çŠ¶æ€åé¦ˆ

**å®ç°ä½ç½®**ï¼š
- `RuoYi-Vue/ruoyi-admin/.../SysBasebandDispatchController.java`

## ğŸ“‹ éƒ¨ç½²æ­¥éª¤

### 1. æ‰§è¡Œæ•°æ®åº“è„šæœ¬
```bash
cd RuoYi-Vue/sql
deploy_macro.bat
```

### 2. ç¼–è¯‘åç«¯ä»£ç 
```bash
cd RuoYi-Vue
mvn clean install
```

### 3. é‡å¯åç«¯æœåŠ¡
```bash
cd RuoYi-Vue/ruoyi-admin
mvn spring-boot:run
```

### 4. åˆ·æ–°å‰ç«¯
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
- åˆ·æ–°é¡µé¢
- è®¿é—®ï¼šåŸºå¸¦ç›‘æ§ > å®ç®¡ç†

## ğŸ§ª æµ‹è¯•æ¸…å•

### åŸºç¡€åŠŸèƒ½æµ‹è¯•
- [ ] å®åˆ—è¡¨æŸ¥è¯¢
- [ ] å®æ–°å¢
- [ ] å®ä¿®æ”¹
- [ ] å®åˆ é™¤
- [ ] å®æœç´¢è¿‡æ»¤
- [ ] å®æ’åº

### å‚æ•°é…ç½®æµ‹è¯•
- [ ] æ‰“å¼€å‚æ•°é…ç½®å¯¹è¯æ¡†
- [ ] æ·»åŠ å‚æ•°
- [ ] åˆ é™¤å‚æ•°
- [ ] ä¿å­˜å‚æ•°é…ç½®
- [ ] å‚æ•°å€¼éªŒè¯

### é›†æˆæµ‹è¯•ï¼ˆå¾…å®ç°åæµ‹è¯•ï¼‰
- [ ] åˆ›å»ºå•å…ƒæ—¶é€‰æ‹©å®
- [ ] å®å‚æ•°è‡ªåŠ¨åº”ç”¨
- [ ] å‚æ•°è‡ªåŠ¨ä¸‹å‘
- [ ] ä¸‹å‘çŠ¶æ€åé¦ˆ

## ğŸ“Š åŠŸèƒ½å®Œæˆåº¦

| æ¨¡å— | å®Œæˆåº¦ | è¯´æ˜ |
|------|--------|------|
| æ•°æ®åº“è®¾è®¡ | 100% | è¡¨ç»“æ„å®Œæ•´ï¼Œç¤ºä¾‹æ•°æ®é½å…¨ |
| åç«¯åŸºç¡€CRUD | 100% | å®çš„å¢åˆ æ”¹æŸ¥å·²å®Œæˆ |
| åç«¯å‚æ•°ç®¡ç† | 30% | æ¡†æ¶å·²æ­å»ºï¼Œéœ€å®ç°å…·ä½“é€»è¾‘ |
| å‰ç«¯å®ç®¡ç† | 100% | å®ç®¡ç†é¡µé¢åŠŸèƒ½å®Œæ•´ |
| å‰ç«¯å‚æ•°é…ç½® | 80% | ç•Œé¢å®Œæ•´ï¼Œéœ€å®Œå–„APIè°ƒç”¨ |
| å•å…ƒåˆ›å»ºé›†æˆ | 0% | å¾…å®ç° |
| å‚æ•°è‡ªåŠ¨ä¸‹å‘ | 0% | å¾…å®ç° |
| æ–‡æ¡£ | 100% | è®¾è®¡æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—å®Œæ•´ |

**æ€»ä½“å®Œæˆåº¦**ï¼šçº¦ 60%

## ğŸ¯ ä¸‹ä¸€æ­¥å·¥ä½œ

### ä¼˜å…ˆçº§1ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
1. å®Œå–„å®å‚æ•°ç®¡ç†çš„Serviceå®ç°
2. åˆ›å»ºå®å‚æ•°Mapperå’ŒXML
3. æµ‹è¯•å®å‚æ•°é…ç½®åŠŸèƒ½

### ä¼˜å…ˆçº§2ï¼ˆé›†æˆåŠŸèƒ½ï¼‰
1. ä¿®æ”¹å•å…ƒåˆ›å»ºé¡µé¢ï¼Œæ·»åŠ å®é€‰æ‹©
2. å®ç°åˆ›å»ºå•å…ƒæ—¶åº”ç”¨å®å‚æ•°
3. æµ‹è¯•å®åº”ç”¨åŠŸèƒ½

### ä¼˜å…ˆçº§3ï¼ˆé«˜çº§åŠŸèƒ½ï¼‰
1. å®ç°å‚æ•°è‡ªåŠ¨ä¸‹å‘
2. æ·»åŠ ä¸‹å‘çŠ¶æ€åé¦ˆ
3. å®Œå–„é”™è¯¯å¤„ç†

## ğŸ’¡ å¼€å‘å»ºè®®

### 1. å®å‚æ•°Mapperå®ç°
åˆ›å»ºæ–‡ä»¶ï¼š`SysBasebandMacroParamMapper.xml`
```xml
<!-- æŸ¥è¯¢å®å‚æ•°ï¼ˆå…³è”å‚æ•°å®šä¹‰ï¼‰ -->
<select id="selectMacroParams" resultType="map">
    SELECT 
        mp.id,
        mp.macro_id,
        mp.param_id,
        mp.param_value,
        pd.param_name,
        pd.param_code,
        pd.value_type,
        pd.enum_options,
        pd.min_value,
        pd.max_value
    FROM sys_baseband_macro_param mp
    LEFT JOIN sys_baseband_param_def pd ON mp.param_id = pd.param_id
    WHERE mp.macro_id = #{macroId}
    ORDER BY pd.hardware_order
</select>
```

### 2. å‰ç«¯å®é€‰æ‹©ç»„ä»¶
å¯ä»¥åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„å®é€‰æ‹©ç»„ä»¶ï¼š
```vue
<!-- MacroSelector.vue -->
<template>
  <div class="macro-selector">
    <el-select v-model="selectedMacroId" @change="handleChange">
      <el-option
        v-for="macro in macros"
        :key="macro.macroId"
        :label="macro.macroName"
        :value="macro.macroId"
      >
        <span>{{ macro.macroName }}</span>
        <span class="macro-tag" v-if="macro.isDefault === '1'">é»˜è®¤</span>
      </el-option>
    </el-select>
    <div class="macro-info" v-if="selectedMacro">
      <el-icon><InfoFilled /></el-icon>
      {{ selectedMacro.description }}
    </div>
  </div>
</template>
```

### 3. å‚æ•°ä¸‹å‘æœåŠ¡
å»ºè®®åˆ›å»ºç‹¬ç«‹çš„ä¸‹å‘æœåŠ¡ï¼š
```java
@Service
public class BasebandDispatchService {
    
    @Autowired
    private MulticastSender multicastSender;
    
    public void dispatchParams(Long unitId) {
        // 1. æŸ¥è¯¢å•å…ƒçš„æ‰€æœ‰å‚æ•°
        List<SysBasebandParamValue> params = paramValueService.selectByUnitId(unitId);
        
        // 2. ç»„è£…ä¸‹å‘æ•°æ®åŒ…
        byte[] data = buildDispatchPacket(params);
        
        // 3. é€šè¿‡ç»„æ’­å‘é€
        multicastSender.send(data);
        
        // 4. è®°å½•ä¸‹å‘æ—¥å¿—
        logDispatch(unitId, params);
    }
}
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚éœ€å¸®åŠ©ï¼Œè¯·å‚è€ƒï¼š
- è¯¦ç»†è®¾è®¡ï¼š`å®ç®¡ç†åŠŸèƒ½è®¾è®¡æ–‡æ¡£.md`
- ä½¿ç”¨æŒ‡å—ï¼š`å®ç®¡ç†å¿«é€Ÿä½¿ç”¨æŒ‡å—.md`
- æ•°æ®åº“è„šæœ¬ï¼š`RuoYi-Vue/sql/baseband_macro.sql`

---

**ç‰ˆæœ¬**ï¼šv1.0  
**åˆ›å»ºæ—¥æœŸ**ï¼š2025-12-09  
**æœ€åæ›´æ–°**ï¼š2025-12-09  
**çŠ¶æ€**ï¼šæ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆï¼Œå¾…å®Œå–„é›†æˆåŠŸèƒ½
