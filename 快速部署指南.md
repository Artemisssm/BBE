# 基带监控模块 - 快速部署指南

## 📋 部署前检查清单

- [ ] MySQL 数据库已安装并运行
- [ ] JDK 1.8+ 已安装
- [ ] Maven 3.6+ 已安装
- [ ] Node.js 14+ 已安装（前端）

## 🚀 快速部署步骤

### 第一步：执行数据库脚本

```bash
# 1. 登录MySQL
mysql -u root -p

# 2. 选择数据库（假设数据库名为 ry-vue）
use ry-vue;

# 3. 执行表结构脚本
source /path/to/RuoYi-Vue/sql/baseband_baseband_monitor.sql

# 4. 执行菜单权限脚本
source /path/to/RuoYi-Vue/sql/baseband_menu.sql

# 5. 验证表是否创建成功
SHOW TABLES LIKE 'sys_baseband%';
```

预期输出：
```
+----------------------------------+
| Tables_in_ry-vue (sys_baseband%) |
+----------------------------------+
| sys_baseband_dispatch_log        |
| sys_baseband_param_def           |
| sys_baseband_param_value         |
| sys_baseband_unit                |
+----------------------------------+
```

### 第二步：配置后端

#### 2.1 配置组播参数（可选）

编辑 `RuoYi-Vue/ruoyi-admin/src/main/resources/application-baseband.yml`：

```yaml
baseband:
  multicast:
    address: 239.255.0.1  # 修改为实际的组播地址
    port: 9000            # 修改为实际的组播端口
    ttl: 16
    # netIf: eth0         # 如需指定网卡，取消注释
```

#### 2.2 引入配置文件

编辑 `RuoYi-Vue/ruoyi-admin/src/main/resources/application.yml`，添加：

```yaml
spring:
  profiles:
    include: baseband  # 添加这一行
```

#### 2.3 编译后端

```bash
cd RuoYi-Vue
mvn clean install -DskipTests
```

#### 2.4 启动后端

```bash
cd ruoyi-admin
mvn spring-boot:run
```

或者运行主类：
```
com.ruoyi.RuoYiApplication
```

### 第三步：配置前端

#### 3.1 安装依赖（如果还没安装）

```bash
cd RuoYi-Vue3
npm install
```

#### 3.2 启动前端

```bash
npm run dev
```

### 第四步：配置权限

1. 访问 http://localhost:80 （或你的前端地址）
2. 使用管理员账号登录（默认：admin/admin123）
3. 进入 **系统管理 > 角色管理**
4. 编辑需要的角色（如：管理员）
5. 在菜单权限中勾选：
   - ✅ 基带监控
   - ✅ 基带单元（及其所有子权限）
   - ✅ 参数定义（及其所有子权限）
6. 点击保存

### 第五步：测试功能

#### 5.1 测试基带单元管理

1. 进入 **系统管理 > 基带监控 > 基带单元**
2. 点击"新增"按钮
3. 填写表单：
   - 单元名称：测试调制单元
   - 单元类型：调制
   - 通道号：1
   - 状态：正常
4. 点击"确定"保存

#### 5.2 测试参数定义

1. 进入 **系统管理 > 基带监控 > 参数定义**
2. 查看预置的参数定义（SQL脚本已自动插入）
3. 可以根据需要新增或修改参数定义

#### 5.3 测试参数配置

1. 回到 **基带单元** 页面
2. 找到刚才创建的单元，点击"参数配置"按钮
3. 系统会显示该单元类型的所有参数
4. 配置参数值：
   - 调制体制：选择 QPSK
   - 符号率：输入 10.0
   - 中频频率：输入 70.0
   - 其他参数按需配置
5. 点击"保存配置"

#### 5.4 测试参数下发

1. 在参数配置页面，点击"下发参数"按钮
2. 确认下发
3. 系统会通过UDP组播发送参数到硬件设备
4. 查看提示消息

#### 5.5 查看下发日志

在数据库中查询：
```sql
SELECT 
    log_id,
    unit_id,
    dispatch_type,
    multicast_ip,
    multicast_port,
    packet_len,
    result_status,
    result_msg,
    send_time
FROM sys_baseband_dispatch_log
ORDER BY log_id DESC
LIMIT 10;
```

## 🔧 常见问题排查

### 问题1：菜单不显示

**原因**：权限未分配或菜单SQL未执行

**解决**：
1. 检查数据库中是否有基带监控相关菜单：
   ```sql
   SELECT * FROM sys_menu WHERE menu_name LIKE '%基带%';
   ```
2. 检查角色权限是否已分配
3. 清除浏览器缓存，重新登录

### 问题2：后端编译失败

**原因**：依赖未正确导入

**解决**：
```bash
mvn clean install -U
```

### 问题3：参数下发失败

**原因**：网络配置或组播地址错误

**解决**：
1. 检查 `application-baseband.yml` 配置
2. 确认服务器网络支持组播
3. 检查防火墙是否允许UDP端口
4. 查看后端日志：
   ```bash
   tail -f logs/sys-info.log
   ```

### 问题4：前端页面样式错误

**原因**：样式文件未加载

**解决**：
1. 检查 `RuoYi-Vue3/src/assets/styles/baseband.css` 是否存在
2. 在 `main.js` 中引入样式：
   ```javascript
   import '@/assets/styles/baseband.css'
   ```
3. 重启前端服务

### 问题5：参数配置页面空白

**原因**：后端接口返回数据为空

**解决**：
1. 检查单元类型是否正确
2. 检查参数定义表中是否有对应单元类型的数据：
   ```sql
   SELECT * FROM sys_baseband_param_def WHERE unit_type = 'MODULATE';
   ```
3. 查看浏览器控制台和网络请求

## 📊 数据验证

### 验证参数定义数据

```sql
-- 查看各单元类型的参数数量
SELECT unit_type, COUNT(*) as param_count
FROM sys_baseband_param_def
GROUP BY unit_type;
```

预期输出：
```
+-------------+-------------+
| unit_type   | param_count |
+-------------+-------------+
| ENCODE      | 9           |
| MODULATE    | 9           |
| DEMODULATE  | 9           |
| DECODE      | 8           |
+-------------+-------------+
```

### 验证菜单数据

```sql
-- 查看基带监控菜单结构
SELECT menu_id, menu_name, parent_id, menu_type, perms
FROM sys_menu
WHERE menu_name LIKE '%基带%'
ORDER BY parent_id, order_num;
```

## 🎯 功能验证清单

部署完成后，请验证以下功能：

- [ ] 基带单元列表查询
- [ ] 基带单元新增
- [ ] 基带单元修改
- [ ] 基带单元删除
- [ ] 基带单元导出
- [ ] 参数定义列表查询
- [ ] 参数定义新增
- [ ] 参数定义修改
- [ ] 参数定义删除
- [ ] 参数定义导出
- [ ] 参数配置页面访问
- [ ] 参数值配置保存
- [ ] 参数下发功能
- [ ] 下发日志记录

## 📝 配置文件位置

### 后端配置
```
RuoYi-Vue/ruoyi-admin/src/main/resources/
├── application.yml              # 主配置文件
├── application-druid.yml        # 数据库配置
└── application-baseband.yml     # 基带监控配置（新增）
```

### 前端配置
```
RuoYi-Vue3/
├── .env.development            # 开发环境配置
├── .env.production             # 生产环境配置
└── src/
    ├── api/system/baseband/    # API接口
    ├── views/system/baseband/  # 页面组件
    └── assets/styles/          # 样式文件
```

## 🔐 默认配置

### 组播配置
- 地址：239.255.0.1
- 端口：9000
- TTL：16

### 数据库表
- sys_baseband_unit：基带单元
- sys_baseband_param_def：参数定义
- sys_baseband_param_value：参数值
- sys_baseband_dispatch_log：下发日志

## 📞 技术支持

如遇到问题，请检查：
1. 后端日志：`RuoYi-Vue/logs/sys-info.log`
2. 前端控制台：浏览器开发者工具
3. 数据库数据：使用SQL查询验证

## ✅ 部署完成

如果所有功能验证通过，恭喜你！基带监控模块已成功部署。

现在你可以：
- 管理基带单元
- 定义参数规则
- 配置参数值
- 下发参数到硬件设备
- 查看下发日志

祝使用愉快！🎉
