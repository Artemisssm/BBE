# 宏管理模块 - 快速使用指南

## 🚀 快速部署

### 步骤1：执行部署脚本
```bash
cd RuoYi-Vue/sql
deploy_macro.bat
```

按提示输入数据库信息，脚本会自动：
- 创建宏管理表
- 添加菜单权限
- 插入示例数据

### 步骤2：重启后端服务
```bash
cd RuoYi-Vue/ruoyi-admin
mvn spring-boot:run
```

### 步骤3：刷新前端
- 清除浏览器缓存（Ctrl+Shift+Delete）
- 刷新页面（Ctrl+F5）
- 在左侧菜单找到：**基带监控 > 宏管理**

## 📝 快速上手

### 场景1：创建第一个宏

1. **进入宏管理页面**
   - 点击左侧菜单：基带监控 > 宏管理

2. **新增宏**
   - 点击"新增"按钮
   - 填写宏信息：
     ```
     宏名称：编码标准配置
     宏编码：ENCODE_STANDARD
     单元类型：编码
     模式类型：KSA
     描述：编码单元的标准参数配置
     是否默认：是
     状态：正常
     ```
   - 点击"确定"

3. **配置参数**
   - 在宏列表中找到刚创建的宏
   - 点击"配置参数"按钮
   - 点击"添加参数"
   - 选择需要配置的参数（如：码率、编码方式、帧长等）
   - 为每个参数设置默认值
   - 点击"保存"

### 场景2：使用宏创建单元

1. **进入基带单元页面**
   - 点击左侧菜单：基带监控 > 基带单元

2. **新增单元并应用宏**
   - 点击"新增"按钮
   - 填写基本信息：
     ```
     链路模式：返向中低速数传
     单元类型：☑编码
     模式类型：KSA
     板卡资源：板1-FPGA0
     ```
   - 在"应用宏配置"下拉框中选择：**编码标准配置**
   - 勾选"创建后立即下发参数到硬件"
   - 点击"确定"

3. **查看结果**
   - 单元创建成功
   - 参数自动应用并下发到硬件
   - 可以在参数配置页面查看已应用的参数

## 💡 使用技巧

### 技巧1：设置默认宏
- 为每种单元类型设置一个默认宏
- 创建单元时会自动选中默认宏
- 减少手动选择的步骤

### 技巧2：宏命名规范
建议使用以下命名格式：
```
{单元类型}-{模式类型}-{用途}
例如：
- 编码-KSA-标准
- 编码-KMA-高速
- 调制-SSA-测试
```

### 技巧3：参数分组管理
为不同场景创建不同的宏：
- **标准配置**：日常使用的标准参数
- **高性能配置**：追求性能的参数设置
- **测试配置**：用于测试的特殊参数
- **调试配置**：便于调试的参数组合

### 技巧4：宏的版本管理
当参数配置需要升级时：
- 不要直接修改现有宏
- 创建新版本的宏（如：编码标准v2.0）
- 保留旧版本宏，便于回退

## 🎯 常见场景

### 场景A：批量创建相同配置的单元
**需求**：创建10个编码单元，都使用相同的参数配置

**步骤**：
1. 创建一个宏，配置好所有参数
2. 批量创建10个单元，都选择这个宏
3. 系统自动为每个单元应用参数并下发

**优势**：
- 配置一次，重复使用
- 确保配置一致性
- 大幅提升效率

### 场景B：快速切换配置方案
**需求**：测试不同参数配置对性能的影响

**步骤**：
1. 创建多个宏，每个宏代表一种配置方案
   - 宏A：低码率配置
   - 宏B：中码率配置
   - 宏C：高码率配置
2. 创建单元时选择不同的宏
3. 对比测试结果

**优势**：
- 快速切换配置
- 便于对比分析
- 可重复测试

### 场景C：新硬件版本适配
**需求**：硬件升级后，参数配置有变化

**步骤**：
1. 创建新版本的宏（如：编码标准v2.0）
2. 配置新版本的参数值
3. 新创建的单元使用新宏
4. 旧单元继续使用旧宏

**优势**：
- 新旧版本并存
- 平滑过渡
- 便于回退

## ⚠️ 注意事项

### 1. 宏编码唯一性
- 宏编码必须唯一
- 建议使用大写字母和下划线
- 格式：`{UNIT_TYPE}_{MODE_TYPE}_{PURPOSE}`

### 2. 参数兼容性
- 宏中配置的参数必须与单元类型匹配
- 编码单元的宏只能配置编码相关的参数
- 系统会自动过滤不匹配的参数

### 3. 默认宏限制
- 每种单元类型+模式类型组合只能有一个默认宏
- 设置新的默认宏时，旧的会自动取消

### 4. 参数值验证
- 参数值必须符合参数定义的约束
- 枚举类型必须是定义的选项之一
- 数值类型必须在最小值和最大值范围内

### 5. 宏删除限制
- 删除宏前，建议先检查是否有单元正在使用
- 删除宏会同时删除其参数配置
- 已应用到单元的参数不受影响

## 🔧 故障排查

### 问题1：宏列表为空
**原因**：数据库脚本未执行或执行失败

**解决**：
```sql
-- 检查宏表是否存在
SHOW TABLES LIKE 'sys_baseband_macro';

-- 检查是否有数据
SELECT COUNT(*) FROM sys_baseband_macro;

-- 如果没有数据，重新执行脚本
source baseband_macro.sql;
```

### 问题2：无法配置参数
**原因**：参数定义表中没有对应单元类型的参数

**解决**：
1. 检查参数定义表是否有数据
2. 确认参数的单元类型与宏的单元类型匹配
3. 如果没有参数，先在参数定义页面创建

### 问题3：创建单元时看不到宏选项
**原因**：前端代码未集成或后端接口未实现

**解决**：
1. 检查前端是否有宏选择下拉框
2. 检查浏览器控制台是否有错误
3. 检查后端接口是否正常返回数据

### 问题4：参数下发失败
**原因**：硬件连接问题或参数值不合法

**解决**：
1. 检查硬件连接状态
2. 检查参数值是否符合约束
3. 查看下发日志，定位具体错误

## 📊 数据结构

### 宏定义表（sys_baseband_macro）
```sql
macro_id       -- 宏ID
macro_name     -- 宏名称
macro_code     -- 宏编码（唯一）
unit_type      -- 单元类型
mode_type      -- 模式类型
description    -- 描述
is_default     -- 是否默认
status         -- 状态
sort_order     -- 排序
```

### 宏参数值表（sys_baseband_macro_param）
```sql
id             -- 主键
macro_id       -- 宏ID
param_id       -- 参数定义ID
param_value    -- 参数值
```

## 🎓 最佳实践

### 1. 宏命名规范
```
✅ 好的命名：
- ENCODE_KSA_STANDARD
- MODULATE_KMA_HIGH_SPEED
- DECODE_SSA_TEST

❌ 不好的命名：
- macro1
- test
- 编码配置
```

### 2. 参数配置原则
- **完整性**：配置所有必要的参数
- **合理性**：参数值要符合实际需求
- **文档化**：在描述中说明配置的用途和场景

### 3. 宏管理策略
- **分类管理**：按单元类型和用途分类
- **版本控制**：重要配置保留多个版本
- **定期审查**：定期检查和更新宏配置

### 4. 团队协作
- **统一命名**：团队内统一宏命名规范
- **文档共享**：维护宏配置文档
- **权限管理**：合理分配宏管理权限

## 🚀 进阶功能（规划中）

### 1. 宏导入导出
- 导出宏配置为JSON文件
- 从JSON文件导入宏配置
- 便于备份和分享

### 2. 宏复制功能
- 基于现有宏快速创建新宏
- 只需修改部分参数
- 提高创建效率

### 3. 宏应用统计
- 统计每个宏的使用次数
- 分析宏的成功率
- 优化宏配置

### 4. 智能推荐
- 根据单元类型推荐合适的宏
- 基于历史使用情况推荐
- 提升用户体验

## 📞 技术支持

如有问题，请查看：
- 详细设计文档：`宏管理功能设计文档.md`
- 数据库脚本：`RuoYi-Vue/sql/baseband_macro.sql`
- 前端代码：`RuoYi-Vue3/src/views/system/baseband/macro/`
- 后端代码：`RuoYi-Vue/ruoyi-system/.../SysBasebandMacro*`

---

**版本**：v1.0  
**更新日期**：2025-12-09  
**适用系统**：基带监控系统 v3.9.0+
