# 16进制参数问题排查指南

## 问题描述

1. SQL执行失败
2. 前端界面没有显示16进制参数

## 解决方案

### 方案1：使用简化版SQL脚本

我已经创建了简化版的SQL脚本，修复了以下问题：
- 移除了 `enum_options` 字段（HEX类型不需要）
- 默认值不包含0x前缀（前端会自动添加）
- 参数代码添加了单元类型前缀，避免冲突

**执行步骤：**
```bash
cd RuoYi-Vue\sql
add_hex_params_simple.bat
```

### 方案2：手动执行SQL

如果批处理失败，可以手动执行：

```bash
mysql -u bbe -p ry-vue < add_hex_params_simple.sql
```

### 方案3：使用Navicat等工具

1. 打开Navicat
2. 连接到 `ry-vue` 数据库
3. 打开 `add_hex_params_simple.sql` 文件
4. 执行SQL

## 验证步骤

### 1. 验证数据库

执行以下SQL查看是否添加成功：

```sql
-- 查看每个单元类型的参数数量
SELECT unit_type, COUNT(*) as count 
FROM sys_baseband_param_def 
GROUP BY unit_type;

-- 查看HEX类型的参数
SELECT unit_type, param_code, param_name, value_type, default_value, hardware_order
FROM sys_baseband_param_def
WHERE value_type = 'HEX'
ORDER BY unit_type, hardware_order;

-- 查看hardware_order = 1, 2的参数（帧头和起始地址）
SELECT unit_type, param_code, param_name, default_value
FROM sys_baseband_param_def
WHERE hardware_order IN (1, 2)
ORDER BY unit_type, hardware_order;
```

预期结果：
- 每个单元类型应该有4个HEX类型的参数
- hardware_order = 1 的是帧头标志（5555）
- hardware_order = 2 的是起始地址（00000000）

### 2. 验证前端显示

1. **刷新浏览器**（Ctrl+F5 强制刷新）
2. **进入基带单元列表**
3. **点击任意单元的"配置"按钮**
4. **检查参数列表**

应该能看到：
- 最前面两个参数：帧头标志、起始地址
- 参数类型显示为红色"16进制"标签
- 输入框带"0x"前缀
- 默认值正确显示（如：0x5555）

### 3. 测试输入

尝试修改16进制参数：
1. 点击帧头标志的输入框
2. 输入 `AAAA`（不需要输入0x）
3. 应该显示为 `0xAAAA`
4. 保存后刷新，值应该保持

## 常见问题

### Q1: SQL执行报错 "Duplicate entry"

**原因**：参数代码已存在

**解决**：先删除已有的HEX参数
```sql
DELETE FROM sys_baseband_param_def WHERE value_type = 'HEX';
```

然后重新执行SQL脚本。

### Q2: SQL执行报错 "Unknown column"

**原因**：表结构不匹配

**解决**：检查表结构
```sql
DESC sys_baseband_param_def;
```

确保有以下字段：
- unit_type
- param_code
- param_name
- value_type
- min_value
- max_value
- scale_factor
- bit_length
- hardware_order
- default_value
- remark
- create_time

### Q3: 前端不显示HEX参数

**可能原因1**：浏览器缓存

**解决**：强制刷新（Ctrl+F5）

**可能原因2**：参数值为空

**解决**：检查数据库中的default_value是否有值
```sql
SELECT param_code, default_value 
FROM sys_baseband_param_def 
WHERE value_type = 'HEX' AND (default_value IS NULL OR default_value = '');
```

如果有空值，更新它们：
```sql
UPDATE sys_baseband_param_def 
SET default_value = '0' 
WHERE value_type = 'HEX' AND (default_value IS NULL OR default_value = '');
```

**可能原因3**：前端代码未更新

**解决**：检查浏览器控制台是否有错误

### Q4: 输入框显示但无法输入

**原因**：参数被禁用或有约束

**解决**：
1. 检查参数是否有 `disabled` 属性
2. 检查是否有约束规则限制了该参数
3. 查看浏览器控制台的错误信息

### Q5: 保存后值变成了0

**原因**：后端没有正确处理HEX类型

**解决**：检查后端日志，确认参数值的保存逻辑

## 调试技巧

### 1. 查看参数加载

打开浏览器控制台（F12），在Network标签中：
1. 刷新参数配置页面
2. 找到 `/system/baseband/value/{unitId}` 请求
3. 查看响应数据中是否包含HEX类型的参数
4. 检查 `valueType` 字段是否为 `'HEX'`
5. 检查 `defaultValue` 是否有值

### 2. 查看参数渲染

在浏览器控制台执行：
```javascript
// 查看所有参数
console.log(paramList.value)

// 查看HEX类型的参数
console.log(paramList.value.filter(p => p.valueType === 'HEX'))

// 查看第一个参数的详细信息
console.log(paramList.value[0])
```

### 3. 查看约束规则

```javascript
// 查看约束映射
console.log(constraintsMap.value)

// 查看某个参数的约束
console.log(constraintsMap.value['ENC_FRAME_HEADER'])
```

## 完整的测试流程

### 1. 数据库测试

```sql
-- 1. 检查参数是否存在
SELECT COUNT(*) FROM sys_baseband_param_def WHERE value_type = 'HEX';
-- 应该返回 16（4个单元 × 4个参数）

-- 2. 检查帧头标志
SELECT * FROM sys_baseband_param_def WHERE param_code LIKE '%FRAME_HEADER';
-- 应该返回4条记录

-- 3. 检查起始地址
SELECT * FROM sys_baseband_param_def WHERE param_code LIKE '%START_ADDR';
-- 应该返回4条记录

-- 4. 检查hardware_order
SELECT unit_type, param_code, hardware_order 
FROM sys_baseband_param_def 
WHERE unit_type = 'ENCODE' 
ORDER BY hardware_order 
LIMIT 5;
-- 前两个应该是 hardware_order = 1, 2
```

### 2. 前端测试

1. **打开参数配置页面**
2. **打开浏览器控制台**
3. **执行以下代码**：

```javascript
// 检查参数列表
const hexParams = paramList.value.filter(p => p.valueType === 'HEX')
console.log('HEX参数数量:', hexParams.length)
console.log('HEX参数:', hexParams.map(p => ({
  code: p.paramCode,
  name: p.paramName,
  value: p.rawValue,
  default: p.defaultValue
})))
```

### 3. 功能测试

1. **查看显示**：HEX参数应该显示红色"16进制"标签
2. **测试输入**：输入 `AAAA`，应该显示为 `0xAAAA`
3. **测试保存**：修改值后保存，刷新页面，值应该保持
4. **测试验证**：输入非16进制字符（如 `GGGG`），应该有错误提示

## 回滚方案

如果需要删除添加的参数：

```sql
-- 删除所有HEX类型的参数
DELETE FROM sys_baseband_param_def WHERE value_type = 'HEX';

-- 恢复hardware_order
UPDATE sys_baseband_param_def 
SET hardware_order = hardware_order - 2 
WHERE unit_type IN ('ENCODE', 'MODULATE', 'DEMODULATE', 'DECODE')
  AND hardware_order > 2;
```

## 联系支持

如果问题仍然存在，请提供：
1. SQL执行的完整错误信息
2. 浏览器控制台的错误信息
3. 数据库查询结果的截图
4. 前端页面的截图

## 更新日期
2024-12-02
