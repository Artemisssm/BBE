# 板卡资源监控功能说明

## 📊 功能概述

在基带监控模块下新增"板卡资源"页面，通过图形化方式展示板卡资源的使用情况，包括：
- 实时统计数据（总板卡数、已用/可用FPGA、使用率）
- 板卡资源分布饼图
- 单元类型分布柱状图
- 板卡详细使用情况图
- 板卡资源详情表格

## 🎨 页面展示

### 1. 顶部统计卡片
四个彩色卡片展示关键指标：
- **板卡总数**（蓝色）- 显示系统配置的板卡总数
- **已用FPGA**（绿色）- 显示已分配的FPGA数量
- **可用FPGA**（橙色）- 显示剩余可用的FPGA数量
- **使用率**（红色）- 显示FPGA资源使用百分比

### 2. 板卡资源分布图（饼图）
- 直观展示已使用和空闲FPGA的比例
- 使用环形饼图，美观易读
- 鼠标悬停显示详细数据

### 3. 单元类型分布图（柱状图）
- 展示**编码、调制、解调、译码**四种单元类型的数量（中文显示）
- 不同类型使用不同颜色区分：
  - 编码：蓝色 (#409EFF)
  - 调制：绿色 (#67C23A)
  - 解调：橙色 (#E6A23C)
  - 译码：红色 (#F56C6C)
- 柱状图顶部显示具体数量

### 4. 板卡详细使用情况图（堆叠柱状图）
- 展示每块板的FPGA0和FPGA1使用情况
- 鼠标悬停显示该板的详细信息
- 快速识别哪些板卡资源紧张

### 5. 板卡资源详情表格
详细列出每块板的信息：
- **板卡**：板卡编号（彩色标签）
- **FPGA0**：显示占用该FPGA的单元名称或"空闲"
- **FPGA1**：显示占用该FPGA的单元名称或"空闲"
- **单元数量**：该板上的单元总数
- **使用率**：进度条显示该板的使用率
- **单元列表**：该板上所有单元的标签列表（中文显示单元类型）
  - 格式：`单元名称-单元类型`
  - 示例：`返向中低速数传-编码`、`前向数传-调制`

## 🚀 部署步骤

### 步骤1：执行SQL脚本添加菜单

#### 方法A：使用批处理脚本（推荐）
```bash
cd RuoYi-Vue/sql
add_resource_menu.bat
```

按提示输入数据库信息即可。

#### 方法B：手动执行SQL
```bash
mysql -uroot -p ry-vue < RuoYi-Vue/sql/add_resource_menu.sql
```

### 步骤2：重启后端服务
```bash
cd RuoYi-Vue/ruoyi-admin
mvn spring-boot:run
```

### 步骤3：刷新前端页面
1. 清除浏览器缓存（Ctrl+Shift+Delete）
2. 刷新页面（Ctrl+F5）
3. 在左侧菜单找到：**基带监控 > 板卡资源**

## 📁 文件清单

### 前端文件
```
RuoYi-Vue3/
├── src/
│   ├── views/system/baseband/resource/
│   │   └── index.vue                    # 板卡资源监控页面
│   └── api/system/
│       └── basebandResource.js          # API接口
```

### 后端文件
```
RuoYi-Vue/
└── ruoyi-admin/src/main/java/com/ruoyi/web/controller/system/
    └── SysBasebandResourceController.java   # 资源统计控制器
```

### SQL文件
```
RuoYi-Vue/sql/
├── add_resource_menu.sql                # 菜单SQL脚本
└── add_resource_menu.bat                # 批处理工具
```

## 🎯 功能特性

### 1. 实时数据
- 页面加载时自动获取最新数据
- 每30秒自动刷新一次
- **基带单元变更时立即刷新**（增删改操作）
- 支持跨标签页实时同步
- 刷新时显示加载动画

### 2. 响应式设计
- 窗口大小改变时图表自动调整
- 支持不同分辨率屏幕
- 移动端友好

### 3. 交互体验
- 统计卡片悬停动画效果
- 图表支持鼠标悬停查看详情
- 表格支持排序和筛选

### 4. 视觉优化
- 使用ECharts专业图表库
- 彩色标签区分不同类型
- 进度条直观显示使用率
- 图标增强可读性

## 📊 数据说明

### 板卡配置
- **默认板卡数**：4块
- **每板FPGA数**：2个（FPGA0和FPGA1）
- **总FPGA资源**：8个

### 通道号映射规则
系统使用 `channelNo` 字段（整数）来标识FPGA资源：
- **板1**：通道1（FPGA0）、通道2（FPGA1）
- **板2**：通道3（FPGA0）、通道4（FPGA1）
- **板3**：通道5（FPGA0）、通道6（FPGA1）
- **板4**：通道7（FPGA0）、通道8（FPGA1）

计算公式：
- 板号 = (通道号 - 1) / 2 + 1
- FPGA编号 = 通道号为奇数时为FPGA0，偶数时为FPGA1

### 资源占用规则
- **普通单元**：占用1个通道（1个FPGA）
- **返向高速**：占用2个连续通道（整块板的2个FPGA）

### 统计逻辑
- **已用FPGA**：统计所有已分配的通道数量
- **可用FPGA**：总通道数 - 已用通道数
- **使用率**：已用通道数 / 总通道数 × 100%

## 🔧 自定义配置

### 修改板卡数量
在 `SysBasebandResourceController.java` 中修改：
```java
int totalBoards = 4;  // 改为你的板卡数量
int fpgasPerBoard = 2; // 改为每板FPGA数量
```

### 修改刷新间隔
在 `index.vue` 中修改：
```javascript
// 定时刷新数据（每30秒）
const timer = setInterval(() => {
  getStats()
}, 30000)  // 改为你想要的毫秒数
```

## 🎨 样式定制

### 修改统计卡片颜色
在 `index.vue` 的 `<style>` 部分修改：
```scss
&.total {
  .stat-icon { color: #409EFF; }  // 蓝色
}
&.used {
  .stat-icon { color: #67C23A; }  // 绿色
}
// ... 其他颜色
```

### 修改图表配色
在各个 `init*Chart` 函数中修改 `itemStyle.color` 属性。

## 📝 使用场景

### 场景1：资源规划
在创建新单元前，查看板卡资源监控页面，了解哪些板卡还有空闲资源。

### 场景2：资源优化
通过使用率统计，识别资源利用不均衡的情况，优化单元分配。

### 场景3：故障排查
当单元创建失败时，查看资源监控确认是否资源不足。

### 场景4：容量规划
根据使用率趋势，提前规划是否需要增加板卡。

## ⚠️ 注意事项

1. **权限配置**：确保用户角色有"板卡资源查询"权限
2. **数据准确性**：统计数据基于基带单元表，确保单元的 `channel_no` 字段正确
3. **性能考虑**：大量单元时，可以调整自动刷新间隔
4. **浏览器兼容**：建议使用Chrome、Edge等现代浏览器

## 🔍 故障排查

### 问题1：菜单不显示
**解决**：
1. 检查SQL脚本是否执行成功
2. 清除浏览器缓存并刷新
3. 检查用户角色权限

### 问题2：图表不显示
**解决**：
1. 检查浏览器控制台是否有错误
2. 确认ECharts库已正确加载
3. 检查后端接口是否正常返回数据

### 问题3：数据不准确
**解决**：
1. 检查基带单元的 `channel_no` 字段格式
2. 确认板卡配置参数是否正确
3. 查看后端日志是否有异常

## 🔄 实时刷新机制

### 自动刷新触发条件
1. **定时刷新**：每30秒自动刷新一次
2. **事件触发**：基带单元发生以下操作时立即刷新
   - 新增单元
   - 修改单元
   - 删除单元

### 跨标签页同步
使用 `BroadcastChannel` API 实现跨标签页通信：
- 在"基带单元"页面操作后，所有打开的"板卡资源"页面都会自动刷新
- 支持多个浏览器标签页同时打开
- 数据实时同步，无需手动刷新

### 实现原理
```javascript
// 基带单元页面：发送事件通知
notifyUnitChanged('add', unitData)

// 板卡资源页面：监听事件并刷新
onBasebandEvent(UNIT_CHANGED, () => {
  getStats() // 重新获取数据
})
```

## 🎉 总结

板卡资源监控功能为基带监控系统提供了直观的资源可视化能力，帮助用户：
- ✅ 实时了解资源使用情况
- ✅ 快速识别资源瓶颈
- ✅ 优化资源分配策略
- ✅ 提升系统管理效率
- ✅ 跨页面实时数据同步

现在你可以通过图形化界面轻松管理板卡资源了！🚀


## 🔤 单元类型显示

### 中文显示
所有单元类型统一使用中文显示，提升可读性：

| 数据库存储 | 前端显示 | 颜色标识 |
|-----------|---------|---------|
| ENCODE    | 编码    | 蓝色 🔵 |
| MODULATE  | 调制    | 绿色 🟢 |
| DEMODULATE| 解调    | 橙色 🟠 |
| DECODE    | 译码    | 红色 🔴 |

### 转换逻辑
- **后端转换**：在 `SysBasebandResourceController` 中通过 `convertUnitType()` 方法转换
- **前端显示**：直接使用后端返回的中文数据
- **一致性**：与基带单元列表、参数配置等页面保持一致

### 应用位置
1. **单元类型分布图**：X轴显示中文类型名称
2. **板卡详情表格**：单元列表标签显示中文
3. **FPGA占用信息**：悬停提示显示中文类型
