# 基带参数定义字段修改完成清单

## 修改概述

完成了基带参数定义模块的字段重构，包括前端、后端和数据库的全面修改。

## 已修改文件清单

### 1. 后端Java文件

#### 1.1 实体类
✅ **RuoYi-Vue/ruoyi-system/src/main/java/com/ruoyi/system/domain/SysBasebandParamDef.java**
- 删除：`scaleFactor`, `bitLength`, `hardwareOrder`
- 新增：`quantizationUnit`, `bitWidthType`, `stepValue`
- 更新：getter/setter方法和toString方法

#### 1.2 VO类
✅ **RuoYi-Vue/ruoyi-system/src/main/java/com/ruoyi/system/domain/vo/BasebandParamVo.java**
- 删除：`hardwareOrder`, `bitLength`
- 新增：`bitWidthType`
- 更新：getter/setter方法

#### 1.3 Service实现类
✅ **RuoYi-Vue/ruoyi-system/src/main/java/com/ruoyi/system/service/impl/SysBasebandParamValueServiceImpl.java**
- 修改：`selectParamValueListByUnitId` 方法中的字段映射
- 修改：`calculateUintValue` 方法的计算逻辑
  - `scaleFactor` → `quantizationUnit`
  - 计算方式从"乘以"改为"除以"

### 2. 后端Mapper XML文件

#### 2.1 参数定义Mapper
✅ **RuoYi-Vue/ruoyi-system/src/main/resources/mapper/system/SysBasebandParamDefMapper.xml**
- 更新：resultMap字段映射
- 更新：selectSysBasebandParamDefVo查询字段
- 更新：insert和update语句
- 修改：排序字段从 `hardware_order` 改为 `param_id`

#### 2.2 参数值Mapper
✅ **RuoYi-Vue/ruoyi-system/src/main/resources/mapper/system/SysBasebandParamValueMapper.xml**
- 更新：`selectParamVoListByUnitId` 查询语句
- 删除：`hardware_order`, `bit_length` 字段
- 新增：`bit_width_type` 字段
- 修改：排序字段从 `hardware_order` 改为 `param_id`

### 3. 前端Vue文件

✅ **RuoYi-Vue3/src/views/system/baseband/paramDef/index.vue**
- 更新：表格列定义
  - 删除："硬件顺序"列
  - 修改："位宽" → "位宽类型"
  - 修改："缩放" → "量化单位"
  - 新增："步进"列
- 更新：表单字段
  - 量化单位：数字输入框，带提示
  - 位宽类型：下拉选择框（U8/U16/U32/I8/I16/I32）
  - 步进值：数字输入框，支持小数
  - 删除：硬件顺序输入框
- 更新：表单验证规则
- 更新：reset函数的默认值

### 4. 数据库SQL文件

✅ **RuoYi-Vue/sql/update_param_def_fields.sql**
- 删除：`hardware_order` 列
- 修改：`scale_factor` → `quantization_unit`
- 修改：`bit_length` → `bit_width_type`
- 新增：`step_value` 列
- 包含：数据迁移和验证语句

### 5. 文档文件

✅ **基带参数定义字段优化说明.md**
- 详细的修改说明
- 使用示例
- 部署步骤
- 注意事项

## 字段对照表

| 旧字段名 | 新字段名 | 类型变化 | 说明 |
|---------|---------|---------|------|
| scale_factor | quantization_unit | INT → INT | 缩放倍数改为量化单位 |
| bit_length | bit_width_type | INT → VARCHAR(10) | 数字改为类型字符串 |
| hardware_order | (删除) | - | 不再需要 |
| - | step_value | 新增 DECIMAL(10,2) | 步进值 |

## 方法名对照表

| 旧方法名 | 新方法名 | 说明 |
|---------|---------|------|
| getScaleFactor() | getQuantizationUnit() | 获取量化单位 |
| setScaleFactor() | setQuantizationUnit() | 设置量化单位 |
| getBitLength() | getBitWidthType() | 获取位宽类型 |
| setBitLength() | setBitWidthType() | 设置位宽类型 |
| getHardwareOrder() | (删除) | 不再需要 |
| setHardwareOrder() | (删除) | 不再需要 |
| - | getStepValue() | 获取步进值 |
| - | setStepValue() | 设置步进值 |

## 计算逻辑变化

### 旧逻辑（缩放倍数）
```java
// 配置值 × 缩放倍数 = 硬件值
uintValue = rawValue * scaleFactor;
```

### 新逻辑（量化单位）
```java
// 配置值 ÷ 量化单位 = 硬件值
uintValue = rawValue / quantizationUnit;
```

**示例**：
- 配置值：100
- 量化单位：10
- 硬件值：100 / 10 = 10

## 部署检查清单

### 1. 数据库更新
- [ ] 备份 `sys_baseband_param_def` 表
- [ ] 执行 `update_param_def_fields.sql`
- [ ] 验证字段是否正确修改
- [ ] 检查数据是否正确迁移

### 2. 后端编译
- [ ] 清理编译缓存：`mvn clean`
- [ ] 重新编译：`mvn package`
- [ ] 检查编译是否成功
- [ ] 检查是否有警告或错误

### 3. 后端部署
- [ ] 停止旧服务
- [ ] 部署新的jar包
- [ ] 启动新服务
- [ ] 检查启动日志

### 4. 前端更新
- [ ] 清除浏览器缓存
- [ ] 刷新页面
- [ ] 重新登录系统

### 5. 功能验证
- [ ] 访问"参数定义"页面
- [ ] 检查表格列是否正确
- [ ] 新增参数，测试位宽类型下拉框
- [ ] 测试量化单位和步进值输入
- [ ] 修改参数，保存后查看数据库
- [ ] 配置参数值，测试下发功能

## 潜在问题和解决方案

### 问题1：编译错误 - 找不到方法
**错误信息**：
```
找不到符号
符号: 方法 getScaleFactor()
位置: 类型为SysBasebandParamDef的变量
```

**解决方案**：
- 已修改所有使用旧方法的地方
- 重新编译即可

### 问题2：数据库字段不存在
**错误信息**：
```
Unknown column 'scale_factor' in 'field list'
```

**解决方案**：
- 确保已执行SQL迁移脚本
- 检查数据库表结构

### 问题3：前端显示异常
**现象**：
- 表格列显示undefined
- 表单无法保存

**解决方案**：
- 清除浏览器缓存
- 强制刷新页面（Ctrl+Shift+R）

### 问题4：参数下发失败
**现象**：
- 下发参数时报错
- 硬件接收到错误的值

**解决方案**：
- 检查量化单位是否正确设置
- 验证计算逻辑是否正确
- 查看下发日志

## 回滚方案

如果出现严重问题需要回滚：

### 1. 数据库回滚
```sql
-- 恢复备份
mysql -u root -p ry-vue < backup_param_def_YYYYMMDD.sql
```

### 2. 代码回滚
```bash
git revert <commit-hash>
```

### 3. 重新部署旧版本

## 验证SQL

```sql
-- 验证字段是否正确
DESC sys_baseband_param_def;

-- 查看数据示例
SELECT 
    param_id, 
    param_code, 
    param_name, 
    quantization_unit, 
    bit_width_type, 
    step_value 
FROM sys_baseband_param_def 
LIMIT 10;

-- 检查是否有NULL值
SELECT COUNT(*) FROM sys_baseband_param_def WHERE quantization_unit IS NULL;
SELECT COUNT(*) FROM sys_baseband_param_def WHERE bit_width_type IS NULL;
```

## 完成状态

✅ 所有文件已修改完成
✅ 编译错误已修复
✅ 文档已更新
✅ SQL脚本已准备

## 下一步操作

1. 执行数据库迁移脚本
2. 重新编译后端项目
3. 部署并测试
4. 验证所有功能正常

## 联系信息

如有问题，请参考：
- 详细说明：`基带参数定义字段优化说明.md`
- SQL脚本：`RuoYi-Vue/sql/update_param_def_fields.sql`
