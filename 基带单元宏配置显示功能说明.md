# 基带单元宏配置显示功能说明

## 功能描述

在基带单元的任务分组视图中，显示该任务使用的宏配置信息。

## 修改内容

### 1. 后端修改

#### 实体类 `SysBasebandUnit.java`
添加了两个字段：
- `macroId` - 宏配置ID（存储在数据库中）
- `macroName` - 宏配置名称（关联查询，用于显示）

#### Mapper XML `SysBasebandUnitMapper.xml`
- 修改了查询语句，关联 `sys_baseband_macro` 表获取宏名称
- 修改了插入和更新语句，支持 `macro_id` 字段

### 2. 数据库修改

需要执行 SQL 脚本为 `sys_baseband_unit` 表添加 `macro_id` 字段：

```sql
-- 执行脚本
RuoYi-Vue/sql/add_macro_id_to_unit.sql
```

或手动执行：
```sql
ALTER TABLE sys_baseband_unit 
ADD COLUMN macro_id BIGINT DEFAULT NULL COMMENT '宏配置ID' AFTER mode_type;

ALTER TABLE sys_baseband_unit 
ADD INDEX idx_macro_id (macro_id);
```

### 3. 前端修改

#### 任务分组视图
- 在任务卡片头部下方添加了宏配置信息显示区域
- 显示格式：`宏配置：卫星1`（去掉了单元类型后缀）

#### 样式
- 添加了 `.task-macro` 样式类
- 使用紫色渐变背景，与宏管理模块风格一致

## 部署步骤

### 1. 执行数据库脚本
```bash
mysql -u root -p bbe < RuoYi-Vue/sql/add_macro_id_to_unit.sql
```

### 2. 重启后端服务
```bash
cd RuoYi-Vue/ruoyi-admin
mvn clean package -DskipTests
# 然后在IDE中重新运行 RuoYiApplication.java
```

### 3. 刷新前端页面
- 清除浏览器缓存（Ctrl+Shift+Delete）
- 刷新页面（Ctrl+F5）

## 使用方式

### 创建带宏配置的基带单元
1. 进入：基带监控 > 基带单元
2. 点击"新增"
3. 选择链路模式、单元类型、模式类型
4. 在"应用宏配置"下拉框中选择一个宏任务
5. 点击"确定"

### 查看宏配置信息
1. 进入：基带监控 > 基带单元
2. 默认显示"按任务分组"视图
3. 每个任务卡片下方会显示宏配置名称（如果有）

## 显示效果

```
┌─────────────────────────────────────────────────────────┐
│ 🖥️ 板1 - FPGA0  [返向中低速数传] [KSA]     [删除任务] │
├─────────────────────────────────────────────────────────┤
│ 🪄 宏配置：卫星1                                        │
├─────────────────────────────────────────────────────────┤
│ ┃ [编码]    v1.0  [正常]     配置 修改 删除            │
│ ┃ [调制]    v1.0  [正常]     配置 修改 删除            │
│ ┃ [解调]    v1.0  [正常]     配置 修改 删除            │
│ ┃ [译码]    v1.0  [正常]     配置 修改 删除            │
└─────────────────────────────────────────────────────────┘
```

## 注意事项

1. **宏名称显示**
   - 显示的是基础宏名称，去掉了单元类型后缀
   - 例如：`卫星1(编码)` 显示为 `卫星1`

2. **宏配置关联**
   - 只有在创建单元时选择了宏配置，才会显示宏信息
   - 已存在的单元需要重新编辑才能关联宏配置

3. **数据库字段**
   - `macro_id` 字段允许为空
   - 删除宏配置不会影响已关联的单元（只是显示为空）

## 相关文件

### 后端
- `RuoYi-Vue/ruoyi-system/src/main/java/com/ruoyi/system/domain/SysBasebandUnit.java`
- `RuoYi-Vue/ruoyi-system/src/main/resources/mapper/system/SysBasebandUnitMapper.xml`

### 前端
- `RuoYi-Vue3/src/views/system/baseband/unit/index.vue`

### 数据库
- `RuoYi-Vue/sql/add_macro_id_to_unit.sql`

---

**创建日期**：2025-12-16  
**状态**：✅ 已完成，等待部署
