# 参数约束功能测试指南

## 测试前准备

### 1. 确保数据库已更新
执行SQL脚本添加 `mode_types` 字段：
```bash
cd RuoYi-Vue\sql
mysql -u bbe -p ry-vue < add_mode_types_simple.sql
```

### 2. 重新编译后端
```bash
cd RuoYi-Vue
mvn clean package -DskipTests
```

### 3. 重启后端服务

### 4. 刷新前端页面

## 测试场景

### 场景1：控件禁用约束

#### 1.1 创建约束
进入"系统管理" → "参数约束" → "新增"

```
源链路模式：返向中低速数传
源单元类型：调制单元
源参数：MOD_TYPE（调制方式）
约束条件：==BPSK

目标链路模式：返向中低速数传
目标单元类型：调制单元
目标参数：CODE_RATE（码率）

模式类型：（不勾选，适用所有模式）

约束类型：控件禁用约束
约束值：（留空）
优先级：15
错误提示：BPSK调制时码率固定为0.5，不可修改
状态：正常
```

#### 1.2 测试效果
1. 进入基带单元列表
2. 找到"返向中低速数传"的调制单元
3. 点击"参数配置"
4. 将调制方式改为BPSK
5. **预期效果**：
   - 码率参数控件自动置灰
   - 底部显示黄色提示框："BPSK调制时码率固定为0.5，不可修改"
   - 无法修改码率值

### 场景2：枚举限制约束（KSA模式特定）

#### 2.1 创建约束
```
源链路模式：返向中低速数传
源单元类型：调制单元
源参数：FREQ_BAND（频段）
约束条件：==K

目标链路模式：返向中低速数传
目标单元类型：调制单元
目标参数：MOD_TYPE（调制方式）

模式类型：☑ KSA

约束类型：枚举限制约束
约束值：BPSK,QPSK,8PSK
优先级：10
错误提示：K频段在KSA模式下仅支持BPSK、QPSK、8PSK调制
状态：正常
```

#### 2.2 测试效果
1. 找到模式类型为"KSA"的调制单元
2. 点击"参数配置"
3. 将频段改为K
4. **预期效果**：
   - 调制方式下拉框只显示BPSK、QPSK、8PSK三个选项
   - 其他选项被过滤掉
   - 底部显示提示："K频段在KSA模式下仅支持BPSK、QPSK、8PSK调制"

### 场景3：值范围约束

#### 3.1 创建约束
```
源链路模式：返向中低速数传
源单元类型：编码单元
源参数：CODE_TYPE（编码类型）
约束条件：==CONV

目标链路模式：返向中低速数传
目标单元类型：编码单元
目标参数：CODE_RATE（码率）

模式类型：（不勾选）

约束类型：值范围约束
约束值：0.5,0.8
优先级：10
错误提示：卷积码的码率范围应为0.5~0.8
状态：正常
```

#### 3.2 测试效果
1. 找到编码单元
2. 点击"参数配置"
3. 将编码类型改为CONV（卷积码）
4. **预期效果**：
   - 码率参数底部显示提示："卷积码的码率范围应为0.5~0.8"
   - 尝试输入0.3，保存时提示错误
   - 输入0.6，保存成功

### 场景4：固定值约束

#### 4.1 创建约束
```
源链路模式：返向高速数传
源单元类型：调制单元
源参数：MOD_TYPE（调制方式）
约束条件：==16QAM

目标链路模式：返向高速数传
目标单元类型：编码单元
目标参数：CODE_RATE（码率）

模式类型：（不勾选）

约束类型：固定值约束
约束值：0.5,0.67,0.75
优先级：10
错误提示：16QAM调制时码率只能选择0.5、0.67或0.75
状态：正常
```

#### 4.2 测试效果
1. 找到"返向高速数传"的编码单元
2. 点击"参数配置"
3. 将调制方式改为16QAM
4. **预期效果**：
   - 码率参数显示提示："16QAM调制时码率只能选择0.5、0.67或0.75"
   - 尝试输入0.8，保存时提示错误
   - 输入0.67，保存成功

### 场景5：模式类型区分

#### 5.1 创建两个约束
**约束1（KSA模式）：**
```
源链路模式：返向中低速数传
源单元类型：调制单元
源参数：MOD_TYPE
约束条件：==QPSK

目标链路模式：返向中低速数传
目标单元类型：调制单元
目标参数：CODE_RATE

模式类型：☑ KSA

约束类型：值范围约束
约束值：0.5,0.7
错误提示：KSA模式下QPSK调制码率范围为0.5~0.7
```

**约束2（KMA模式）：**
```
源链路模式：返向中低速数传
源单元类型：调制单元
源参数：MOD_TYPE
约束条件：==QPSK

目标链路模式：返向中低速数传
目标单元类型：调制单元
目标参数：CODE_RATE

模式类型：☑ KMA

约束类型：值范围约束
约束值：0.6,0.9
错误提示：KMA模式下QPSK调制码率范围为0.6~0.9
```

#### 5.2 测试效果
1. 找到模式类型为"KSA"的调制单元
2. 将调制方式改为QPSK
3. **预期效果**：显示提示"KSA模式下QPSK调制码率范围为0.5~0.7"
4. 输入0.8，保存失败

5. 找到模式类型为"KMA"的调制单元
6. 将调制方式改为QPSK
7. **预期效果**：显示提示"KMA模式下QPSK调制码率范围为0.6~0.9"
8. 输入0.8，保存成功

## 验证要点

### 1. 约束提示显示
- [ ] 参数卡片底部显示黄色提示框
- [ ] 提示内容为约束的错误提示信息
- [ ] 提示框有图标和文字

### 2. 控件禁用
- [ ] 满足条件时控件置灰
- [ ] 鼠标悬停显示禁用状态
- [ ] 无法修改参数值

### 3. 枚举限制
- [ ] 下拉框只显示允许的选项
- [ ] 不允许的选项被过滤
- [ ] 当前值如果不在允许列表中，显示为空

### 4. 值验证
- [ ] 输入不符合约束的值时，保存失败
- [ ] 显示约束的错误提示信息
- [ ] 自动保存状态显示"验证失败"

### 5. 模式类型匹配
- [ ] 只应用匹配模式类型的约束
- [ ] 不同模式下约束规则不同
- [ ] 空模式类型的约束适用所有模式

### 6. 实时更新
- [ ] 修改源参数后，目标参数的约束立即生效
- [ ] 约束提示实时更新
- [ ] 控件状态实时变化

### 7. 性能
- [ ] 页面加载速度正常
- [ ] 参数修改响应及时
- [ ] 没有明显的卡顿

## 常见问题排查

### 问题1：约束不生效
**检查项**：
1. 约束状态是否为"正常"
2. 源链路模式、源单元类型是否匹配
3. 目标链路模式、目标单元类型是否匹配
4. 模式类型是否匹配
5. 约束条件是否满足
6. 浏览器控制台是否有错误

### 问题2：约束提示不显示
**检查项**：
1. 约束是否有错误提示信息
2. 约束条件是否满足
3. 前端是否成功加载约束数据
4. 浏览器控制台查看网络请求

### 问题3：枚举选项没有被限制
**检查项**：
1. 约束类型是否为"枚举限制约束"
2. 约束值格式是否正确（逗号分隔）
3. 约束值是否与枚举选项的value匹配
4. 约束条件是否满足

### 问题4：验证失败但没有提示
**检查项**：
1. 后端日志查看验证错误
2. 浏览器控制台查看错误信息
3. 约束的错误提示信息是否填写
4. 网络请求是否成功

## 测试数据清理

测试完成后，可以删除测试约束：
1. 进入"系统管理" → "参数约束"
2. 勾选测试创建的约束
3. 点击"删除"按钮
4. 确认删除

## 更新日期
2024-12-02
