# 16进制参数快速添加指南

## 问题：Duplicate entry 错误

如果遇到 `Duplicate entry 'XXX' for key 'uk_param_code'` 错误，说明参数已经存在。

## 解决方案

### 方案1：使用一键脚本（推荐）

这个脚本会先清理再添加，避免重复：

```bash
cd RuoYi-Vue\sql
reset_and_add_hex_params.bat
```

输入MySQL密码后，脚本会自动：
1. 删除所有HEX类型的参数
2. 重新添加24个有序的HEX参数
3. 确保帧头和起始地址在最前面

### 方案2：分步执行

#### 第一步：清理已存在的参数
```bash
cd RuoYi-Vue\sql
clean_hex_params.bat
```

#### 第二步：添加新参数
```bash
add_hex_params_ordered.bat
```

### 方案3：手动清理

如果批处理失败，可以手动执行SQL：

```sql
-- 查看要删除的参数
SELECT param_id, unit_type, param_code, param_name 
FROM sys_baseband_param_def 
WHERE value_type = 'HEX';

-- 删除所有HEX参数
DELETE FROM sys_baseband_param_def WHERE value_type = 'HEX';

-- 验证删除
SELECT unit_type, COUNT(*) as count 
FROM sys_baseband_param_def 
GROUP BY unit_type;
```

然后重新执行 `add_hex_params_ordered.bat`

## 验证结果

执行成功后，运行以下SQL验证：

```sql
-- 1. 查看HEX参数数量
SELECT unit_type, 
       COUNT(*) as total,
       SUM(CASE WHEN value_type = 'HEX' THEN 1 ELSE 0 END) as hex_count
FROM sys_baseband_param_def 
GROUP BY unit_type;

-- 应该显示每个单元有6个HEX参数

-- 2. 查看编码单元的参数顺序
SELECT param_id, param_code, param_name, value_type
FROM sys_baseband_param_def
WHERE unit_type = 'ENCODE'
ORDER BY param_id
LIMIT 10;

-- 前两个应该是：
-- ENC_FRAME_HEADER - 帧头标志
-- ENC_START_ADDR - 起始地址

-- 3. 查看所有HEX参数
SELECT param_id, unit_type, param_code, param_name, bit_width_type, default_value
FROM sys_baseband_param_def
WHERE value_type = 'HEX'
ORDER BY unit_type, param_id;
```

## 前端验证

1. **刷新浏览器**（Ctrl+F5）
2. **进入基带单元列表**
3. **点击任意单元的"配置"**
4. **检查参数顺序**：
   - 第1个参数：帧头标志（0x5555）
   - 第2个参数：起始地址（0x00000000）
   - 后面是其他参数

## 常见问题

### Q1: 删除后重新添加，参数顺序还是不对

**原因**：其他类型的参数占用了前面的param_id

**解决**：这是正常的。只要同一单元类型内，帧头和起始地址在最前面就可以了。

### Q2: 前端看不到新参数

**解决**：
1. 强制刷新浏览器（Ctrl+F5）
2. 清除浏览器缓存
3. 检查浏览器控制台是否有错误

### Q3: 参数显示但值不对

**解决**：
1. 检查数据库中的default_value
2. 确认前端正确处理了HEX类型
3. 查看浏览器控制台的网络请求

## 文件说明

### SQL脚本
- `clean_hex_params.sql` - 清理HEX参数
- `add_hex_params_ordered.sql` - 有序添加HEX参数
- `reset_and_add_hex_params.bat` - 一键重置并添加（推荐）

### 批处理文件
- `clean_hex_params.bat` - 清理脚本
- `add_hex_params_ordered.bat` - 添加脚本
- `reset_and_add_hex_params.bat` - 一键脚本（推荐）

## 添加的参数列表

### 每个单元类型都有以下6个参数：

1. **帧头标志** (FRAME_HEADER)
   - 类型：U16
   - 默认值：5555
   - 说明：固定值0x5555

2. **起始地址** (START_ADDR)
   - 类型：U32
   - 默认值：00000000
   - 说明：参数起始地址

3. **同步字/导频图案/同步模式**
   - 类型：U32
   - 默认值：1ACFFC1D / 12345678
   - 说明：帧同步或导频相关

4. **扰码种子/解扰种子**
   - 类型：U16
   - 默认值：FFFF / 0001
   - 说明：扰码器相关

5. **CRC多项式/同步标记/导频掩码**
   - 类型：U32 / U8
   - 默认值：04C11DB7 / 47 / FFFFFFFF
   - 说明：CRC或同步相关

6. **掩码模式/帧标识/载波偏移/错误掩码**
   - 类型：U8 / U16
   - 默认值：AA / ABCD / 0000 / 00
   - 说明：其他辅助参数

## 总结

**推荐使用方式**：
```bash
cd RuoYi-Vue\sql
reset_and_add_hex_params.bat
```

这个脚本会自动处理所有问题，确保参数正确添加且顺序正确。

## 更新日期
2024-12-03
