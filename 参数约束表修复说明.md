# 参数约束表修复说明

## 问题描述

错误信息：`Unknown column 'source_param_name' in 'field list'`

**原因**：数据库表结构与Java代码不一致
- 旧SQL使用：`source_param_code`、`target_param_code`
- Java代码使用：`source_param_name`、`target_param_name`

## 解决方案

### 方法1：使用修复SQL（推荐）

1. 打开数据库管理工具（如Navicat、DBeaver、MySQL Workbench）
2. 连接到你的数据库
3. 执行以下SQL文件：

```
RuoYi-Vue/sql/fix_param_constraint_table.sql
```

这个SQL会：
- 删除旧表
- 创建新表（字段名正确）
- 插入测试数据

### 方法2：使用命令行

```bash
# 进入MySQL
mysql -u root -p

# 选择数据库
use your_database_name;

# 执行SQL文件
source D:/Desktop/Work/Code/BBE/RuoYi-Vue/sql/fix_param_constraint_table.sql
```

### 方法3：手动执行SQL

如果上述方法不可用，可以手动复制以下SQL并执行：

```sql
-- 删除旧表
DROP TABLE IF EXISTS sys_baseband_param_constraint;

-- 创建新表
CREATE TABLE sys_baseband_param_constraint (
    constraint_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '约束规则主键',
    source_unit_name VARCHAR(50) COMMENT '源单元名称（*表示通配）',
    source_unit_type VARCHAR(16) COMMENT '源单元类型（*表示通配）',
    source_param_name VARCHAR(64) NOT NULL COMMENT '源参数名称',
    target_unit_name VARCHAR(50) COMMENT '目标单元名称（*表示通配）',
    target_unit_type VARCHAR(16) COMMENT '目标单元类型（*表示通配）',
    target_param_name VARCHAR(64) NOT NULL COMMENT '目标参数名称',
    constraint_type VARCHAR(20) NOT NULL COMMENT '约束类型',
    constraint_condition VARCHAR(100) COMMENT '约束条件',
    constraint_value VARCHAR(200) COMMENT '约束值',
    priority INT DEFAULT 10 COMMENT '优先级',
    error_message VARCHAR(500) COMMENT '错误提示信息',
    status CHAR(1) DEFAULT '0' COMMENT '状态：0=正常，1=停用',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    remark VARCHAR(500) COMMENT '备注',
    PRIMARY KEY (constraint_id),
    KEY idx_source_unit (source_unit_name, source_unit_type),
    KEY idx_target_unit (target_unit_name, target_unit_type),
    KEY idx_source_param (source_param_name),
    KEY idx_target_param (target_param_name),
    KEY idx_priority (priority)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='基带参数约束规则表';

-- 插入测试数据
INSERT INTO sys_baseband_param_constraint (
    source_unit_name, source_unit_type, source_param_name,
    target_unit_name, target_unit_type, target_param_name,
    constraint_type, constraint_condition, constraint_value,
    priority, error_message, status, remark
) VALUES 
('*', 'ENCODE', 'ENC_CODE_TYPE', '*', 'ENCODE', 'ENC_CODE_RATE', 
 'VALUE_RANGE', '==CONV', '0.33,0.75', 10, 
 '卷积码的码率范围应为0.33~0.75', '0', '通用约束'),
 
('返向中低速数传', 'ENCODE', 'ENC_CODE_TYPE', '返向中低速数传', 'ENCODE', 'ENC_CODE_RATE', 
 'VALUE_RANGE', '==CONV', '0.5,0.8', 15, 
 '返向中低速数传卷积码的码率范围应为0.5~0.8', '0', '特定单元约束');
```

## 验证

执行完SQL后，验证表结构：

```sql
-- 查看表结构
DESC sys_baseband_param_constraint;

-- 查看数据
SELECT * FROM sys_baseband_param_constraint;
```

应该看到：
- `source_param_name` 字段存在
- `target_param_name` 字段存在
- 有2条测试数据

## 重启应用

修复数据库后，重启Spring Boot应用，然后再次测试参数修改功能。

## 注意事项

1. **备份数据**：如果旧表中有重要数据，请先备份
2. **数据库名称**：确保连接到正确的数据库
3. **权限**：确保数据库用户有DROP和CREATE权限
4. **字符集**：表使用utf8mb4字符集，支持中文

## 后续步骤

表修复完成后，可以：

1. 测试参数约束验证功能
2. 添加更多约束规则（参考 `insert_param_constraints_by_unit_name.sql`）
3. 在约束管理界面中管理约束规则

## 文件说明

- `fix_param_constraint_table.sql` - 快速修复SQL（推荐使用）
- `create_param_constraint_table.sql` - 完整的建表SQL（已更新）
- `insert_param_constraints_by_unit_name.sql` - 详细的约束规则数据
