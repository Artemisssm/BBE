# 约束规则快速参考

## 六种约束场景

### 1️⃣ 值范围约束
**场景**：一个值的改变影响另一个值的范围

```
编码方式 = CONV  →  码率范围 = 0.5~0.8
```

**配置**：
- 约束类型：`VALUE_RANGE`
- 动作类型：`RANGE`
- 约束条件：`==CONV`
- 约束值：`0.5,0.8`
- 动作值：`{"min": 0.5, "max": 0.8}`
- UI效果：`HIGHLIGHT`

### 2️⃣ 固定值约束
**场景**：一个值的改变使得另一个值固定取一个值

```
ACM启用 = 1  →  码率 = 0.75（固定）
```

**配置**：
- 约束类型：`FIXED_VALUE`
- 动作类型：`FIXED`
- 约束条件：`==1`
- 约束值：`0.75`
- 动作值：`{"value": 0.75}`
- UI效果：`READONLY`

### 3️⃣ 禁用约束
**场景**：一个值的改变影响另一个值置灰不能操作

```
自动模式 = 1  →  码率（禁用，灰色）
```

**配置**：
- 约束类型：`ENABLE_DISABLE`
- 动作类型：`DISABLE`
- 约束条件：`==1`
- 约束值：（留空）
- 动作值：`{}`
- UI效果：`DISABLED`

### 4️⃣ 枚举限制约束
**场景**：若枚举值被影响，限制可选的枚举选项

```
编码方式 = CONV  →  码率只能选：0.5, 0.67, 0.75
```

**配置**：
- 约束类型：`ENUM_LIMIT`
- 动作类型：`ENUM_LIMIT`
- 约束条件：`==CONV`
- 约束值：`0.5,0.67,0.75`
- 动作值：`{"allowedValues": ["0.5", "0.67", "0.75"]}`
- UI效果：`HIGHLIGHT`

### 5️⃣ 值同步约束
**场景**：两个参数值保持一致

```
编码ACM = 1  →  调制ACM = 1（自动同步）
```

**配置**：
- 约束类型：`VALUE_SYNC`
- 动作类型：`SYNC`
- 约束条件：（留空）
- 约束值：（留空）
- 动作值：`{"autoSync": true}`
- UI效果：`READONLY`

### 6️⃣ 链路模式约束
**场景**：源参数可以为空，靠链路模式来做约束

```
链路模式 = 返向中低速数传  →  符号率范围 = 1~100
```

**配置**：
- 源参数：`NULL`（留空）
- 约束类型：`VALUE_RANGE`
- 动作类型：`RANGE`
- 约束条件：（留空）
- 约束值：`1,100`
- 动作值：`{"min": 1, "max": 100}`
- UI效果：`HIGHLIGHT`

## 约束条件格式

| 条件 | 格式 | 说明 | 示例 |
|------|------|------|------|
| 等于 | `==值` | 源参数等于某值 | `==CONV` |
| 不等于 | `!=值` | 源参数不等于某值 | `!=LDPC` |
| 大于 | `>值` | 源参数大于某值 | `>10` |
| 小于 | `<值` | 源参数小于某值 | `<100` |
| 大于等于 | `>=值` | 源参数大于等于某值 | `>=0.5` |
| 小于等于 | `<=值` | 源参数小于等于某值 | `<=0.8` |
| 留空 | （空） | 始终生效 | - |

## 动作类型

| 动作类型 | 说明 | 动作值格式 |
|----------|------|------------|
| `RANGE` | 调整范围 | `{"min": 最小值, "max": 最大值}` |
| `FIXED` | 固定值 | `{"value": 固定值}` |
| `DISABLE` | 禁用参数 | `{}` |
| `ENUM_LIMIT` | 限制枚举 | `{"allowedValues": ["值1", "值2"]}` |
| `SYNC` | 同步值 | `{"autoSync": true}` |
| `AUTO_SET` | 自动设置 | `{"value": 自动值}` |

## UI效果

| UI效果 | 说明 | 视觉效果 |
|--------|------|----------|
| `READONLY` | 只读 | 灰色，可见但不可编辑 |
| `DISABLED` | 禁用 | 灰色，完全不可操作 |
| `HIDDEN` | 隐藏 | 不显示 |
| `HIGHLIGHT` | 高亮 | 黄色边框或背景提示 |

## 优先级规则

### 执行顺序：从低到高

```
优先级 10 → 优先级 15 → 优先级 20
通用约束    特定约束    强制约束
```

### 优先级建议

| 范围 | 级别 | 说明 | 示例 |
|------|------|------|------|
| 0 | 提示 | 仅提示，不强制 | 推荐值 |
| 1-9 | 一般 | 一般约束 | 推荐范围 |
| 10-19 | 重要 | 重要约束 | 编码方式影响码率 |
| 20+ | 强制 | 必须满足 | ACM联动 |

### 覆盖规则

**后执行的约束会覆盖先执行的约束**

示例：
```
优先级10：码率范围 0.33~0.75
优先级15：码率范围 0.5~0.8
优先级20：码率固定 0.75

最终生效：码率固定 0.75
```

## 配置示例

### 示例1：编码方式影响码率范围

```sql
源链路模式: 返向中低速数传
源单元类型: 编码单元
源参数: ENC_CODE_TYPE

目标链路模式: 返向中低速数传
目标单元类型: 编码单元
目标参数: ENC_CODE_RATE

约束类型: VALUE_RANGE
约束条件: ==CONV
约束值: 0.5,0.8

动作类型: RANGE
动作值: {"min": 0.5, "max": 0.8}
UI效果: HIGHLIGHT

优先级: 15
错误提示: 卷积码的码率范围应为0.5~0.8
```

### 示例2：ACM启用时码率固定

```sql
源链路模式: ACM数传
源单元类型: 编码单元
源参数: ACM_ENABLE

目标链路模式: ACM数传
目标单元类型: 编码单元
目标参数: ENC_CODE_RATE

约束类型: FIXED_VALUE
约束条件: ==1
约束值: 0.75

动作类型: FIXED
动作值: {"value": 0.75}
UI效果: READONLY

优先级: 20
错误提示: ACM启用时码率固定为0.75
```

### 示例3：链路模式约束符号率

```sql
源链路模式: 返向中低速数传
源单元类型: 调制单元
源参数: NULL  ← 留空

目标链路模式: 返向中低速数传
目标单元类型: 调制单元
目标参数: MOD_SYMBOL_RATE

约束类型: VALUE_RANGE
约束条件: （留空）
约束值: 1,100

动作类型: RANGE
动作值: {"min": 1, "max": 100}
UI效果: HIGHLIGHT

优先级: 10
错误提示: 返向中低速数传的符号率范围为1~100
```

## 前端效果

### 值范围约束
```
参数：码率
当前范围：0.33 ~ 0.75
↓ 编码方式改为CONV
新范围：0.5 ~ 0.8（黄色高亮）
```

### 固定值约束
```
参数：码率
当前值：0.67（可编辑）
↓ ACM启用
新值：0.75（灰色只读）
```

### 禁用约束
```
参数：码率
当前：可编辑
↓ 自动模式启用
新状态：禁用（灰色不可操作）
```

### 枚举限制约束
```
参数：码率
所有选项：0.33, 0.5, 0.67, 0.75, 0.8
↓ 编码方式改为CONV
可选项：0.5, 0.67, 0.75（其他选项隐藏）
```

### 值同步约束
```
参数：编码ACM
当前值：1
↓ 自动同步
调制ACM：1（自动设置，只读）
```

### 链路模式约束
```
链路模式：返向中低速数传
↓ 自动应用
符号率范围：1 ~ 100（黄色高亮）
```

## 常见问题

### Q1：如何创建链路模式约束？
**A**：源参数留空（NULL），只填写链路模式和目标参数。

### Q2：优先级如何设置？
**A**：通用约束10，特定约束15，强制约束20+。

### Q3：多个约束冲突怎么办？
**A**：优先级高的最后执行，会覆盖低优先级的约束。

### Q4：如何禁用某个约束？
**A**：将状态改为"停用"（status=1）。

### Q5：枚举限制如何配置？
**A**：
- 约束值：`0.5,0.67,0.75`（逗号分隔）
- 动作值：`{"allowedValues": ["0.5", "0.67", "0.75"]}`

## 部署步骤

1. **升级数据库**
   ```bash
   双击运行：upgrade_constraint_table.bat
   ```

2. **重启应用**
   ```bash
   重启Spring Boot应用
   ```

3. **刷新浏览器**
   ```bash
   Ctrl + F5 强制刷新
   ```

4. **测试功能**
   - 在约束管理界面添加新约束
   - 在参数配置界面测试约束效果

## 总结

✅ 6种约束场景全覆盖
✅ 优先级机制完善
✅ 支持链路模式约束
✅ UI效果丰富
✅ 配置灵活强大

现在你可以创建各种复杂的参数约束规则了！
