# 参数定义位宽范围限制说明

## 功能概述

在参数定义模块中，为整数和浮点数类型的参数添加了基于位宽类型的自动范围限制功能。当用户输入的最小值或最大值超出位宽类型的有效范围时，系统会自动调整到边界值并提示用户。

## 位宽类型范围对照表

| 位宽类型 | 位数 | 符号类型 | 最小值 | 最大值 | 说明 |
|---------|------|---------|--------|--------|------|
| **U8** | 8 | 无符号 | 0 | 255 | 8位无符号整数 |
| **U16** | 16 | 无符号 | 0 | 65,535 | 16位无符号整数 |
| **U32** | 32 | 无符号 | 0 | 4,294,967,295 | 32位无符号整数 |
| **I8** | 8 | 有符号 | -128 | 127 | 8位有符号整数 |
| **I16** | 16 | 有符号 | -32,768 | 32,767 | 16位有符号整数 |
| **I32** | 32 | 有符号 | -2,147,483,648 | 2,147,483,647 | 32位有符号整数 |

## 功能特性

### 1. 实时范围提示

在最小值和最大值输入框下方，实时显示当前位宽类型的有效范围：

```
范围: 0 ~ 255          (U8)
范围: 0 ~ 65,535       (U16)
范围: -128 ~ 127       (I8)
范围: -32,768 ~ 32,767 (I16)
```

### 2. 自动边界调整

当输入值超出范围时，自动调整到边界值：

**示例1：U8类型**
- 输入最小值：-10 → 自动调整为 0
- 输入最大值：300 → 自动调整为 255

**示例2：I8类型**
- 输入最小值：-200 → 自动调整为 -128
- 输入最大值：200 → 自动调整为 127

### 3. 最小值/最大值关系验证

确保最小值不大于最大值，最大值不小于最小值：

- 如果最小值 > 最大值 → 最小值自动调整为最大值
- 如果最大值 < 最小值 → 最大值自动调整为最小值

### 4. 位宽类型变化联动

当位宽类型改变时，自动检查并调整已输入的最小值和最大值：

**场景示例**：
1. 选择 U16，输入最小值 0，最大值 1000
2. 改为 U8
3. 系统自动检查：最大值 1000 超出 U8 范围
4. 自动调整最大值为 255
5. 弹出提示："最大值不能大于 255，已自动调整"

## 使用流程

### 流程1：新增参数

1. 选择值类型：整数(UINT) 或 浮点(FLOAT)
2. 选择位宽类型：如 U16
3. 查看范围提示：范围: 0 ~ 65,535
4. 输入最小值：如 0
5. 输入最大值：如 1000
6. 系统验证：通过（在范围内）
7. 保存成功

### 流程2：超出范围自动调整

1. 选择位宽类型：U8
2. 输入最小值：-10
3. 系统自动调整为：0
4. 弹出提示："最小值不能小于 0，已自动调整"
5. 输入最大值：300
6. 系统自动调整为：255
7. 弹出提示："最大值不能大于 255，已自动调整"

### 流程3：修改位宽类型

1. 已有参数：位宽类型 U16，最小值 0，最大值 1000
2. 修改位宽类型为：U8
3. 系统检查：最大值 1000 超出 U8 范围
4. 自动调整最大值为：255
5. 弹出提示："最大值不能大于 255，已自动调整"

## 技术实现

### 1. 位宽范围定义

```javascript
const bitWidthRanges = {
  'U8': { min: 0, max: 255, label: '范围: 0 ~ 255' },
  'U16': { min: 0, max: 65535, label: '范围: 0 ~ 65,535' },
  'U32': { min: 0, max: 4294967295, label: '范围: 0 ~ 4,294,967,295' },
  'I8': { min: -128, max: 127, label: '范围: -128 ~ 127' },
  'I16': { min: -32768, max: 32767, label: '范围: -32,768 ~ 32,767' },
  'I32': { min: -2147483648, max: 2147483647, label: '范围: -2,147,483,648 ~ 2,147,483,647' }
}
```

### 2. 计算属性

```javascript
const bitWidthRange = computed(() => {
  const bitWidthType = form.value.bitWidthType
  if (bitWidthType && bitWidthRanges[bitWidthType]) {
    return bitWidthRanges[bitWidthType]
  }
  return { min: 0, max: 65535, label: '请先选择位宽类型' }
})
```

### 3. 输入框配置

```vue
<el-input-number 
  v-model="form.minValue" 
  :min="bitWidthRange.min"
  :max="bitWidthRange.max"
  @change="handleMinValueChange"
/>
```

### 4. 变化处理函数

```javascript
function handleMinValueChange(value) {
  const range = bitWidthRange.value
  
  // 边界检查
  if (value < range.min) {
    form.value.minValue = range.min
    proxy.$modal.msgWarning(`最小值不能小于 ${range.min}，已自动调整`)
  } else if (value > range.max) {
    form.value.minValue = range.max
    proxy.$modal.msgWarning(`最小值不能大于 ${range.max}，已自动调整`)
  }
  
  // 最小值/最大值关系检查
  if (form.value.maxValue !== null && form.value.minValue > form.value.maxValue) {
    form.value.minValue = form.value.maxValue
    proxy.$modal.msgWarning('最小值不能大于最大值，已自动调整')
  }
}
```

## 使用示例

### 示例1：定义温度参数（I16）

```
参数名称：工作温度
值类型：FLOAT
位宽类型：I16
范围提示：范围: -32,768 ~ 32,767

输入最小值：-40 ✓ (在范围内)
输入最大值：85 ✓ (在范围内)

结果：保存成功
```

### 示例2：定义功率参数（U8）

```
参数名称：发射功率
值类型：UINT
位宽类型：U8
范围提示：范围: 0 ~ 255

输入最小值：0 ✓
输入最大值：300 ✗ (超出范围)
自动调整为：255
提示：最大值不能大于 255，已自动调整

结果：最大值 = 255，保存成功
```

### 示例3：修改位宽类型

```
原配置：
- 位宽类型：U16
- 最小值：0
- 最大值：1000

修改位宽类型为：U8
系统检查：1000 > 255
自动调整：最大值 = 255
提示：最大值不能大于 255，已自动调整

结果：最大值自动调整为 255
```

## 用户体验优化

### 1. 即时反馈
- 输入超出范围时立即调整
- 弹出友好的提示信息
- 不阻塞用户操作

### 2. 视觉提示
- 输入框下方显示范围提示
- 使用灰色小字，不干扰主要内容
- 范围数字使用千分位分隔符，易读

### 3. 智能调整
- 自动调整到最接近的有效值
- 保持最小值/最大值的逻辑关系
- 避免用户手动修正

## 注意事项

### 1. 浮点数精度

对于浮点数类型（FLOAT），虽然位宽限制的是整数范围，但实际配置值可以是小数：

```
位宽类型：I16 (范围: -32,768 ~ 32,767)
最小值：-40.5 ✓ (在范围内)
最大值：85.3 ✓ (在范围内)
```

### 2. 量化单位影响

下发给硬件时，实际值会除以量化单位：

```
配置值：100
量化单位：10
下发值：100 / 10 = 10

因此配置值的范围应该考虑量化单位的影响
```

### 3. 默认位宽类型

如果未选择位宽类型，默认使用 U16 的范围（0 ~ 65,535）。

### 4. 已有数据兼容

对于已存在的参数定义：
- 如果位宽类型为空，不进行范围限制
- 修改时会应用新的范围限制
- 建议逐步更新旧数据的位宽类型

## 扩展性

如果将来需要支持更多位宽类型，只需在 `bitWidthRanges` 对象中添加：

```javascript
const bitWidthRanges = {
  // ... 现有类型
  'U64': { 
    min: 0, 
    max: 18446744073709551615, 
    label: '范围: 0 ~ 18,446,744,073,709,551,615' 
  },
  'I64': { 
    min: -9223372036854775808, 
    max: 9223372036854775807, 
    label: '范围: -9,223,372,036,854,775,808 ~ 9,223,372,036,854,775,807' 
  }
}
```

## 总结

通过实现基于位宽类型的自动范围限制功能：

1. **提升数据准确性**：确保参数值在硬件支持的范围内
2. **改善用户体验**：自动调整，无需手动修正
3. **减少配置错误**：避免超出范围的无效配置
4. **增强系统健壮性**：前端验证，减少后端和硬件错误

这个功能特别适合需要精确控制参数范围的硬件接口场景。
