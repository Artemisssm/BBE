# 宏管理"配置参数"功能快速修复

## 🐛 问题描述

点击"配置参数"按钮时报错：
```
1. You have an error in your SQL syntax... near 'maxValue'
2. Unknown column 'pd.bit_length' in 'field list'
3. Unknown column 'pd.hardware_order' in 'field list'
```

## ✅ 已修复

### 问题1：MySQL保留关键字
**原因**：`maxValue` 和 `defaultValue` 在某些MySQL版本中是保留关键字（分区表相关），作为别名时需要用反引号包裹。

**修复**：为别名添加反引号
```xml
pd.max_value AS `maxValue`,
pd.default_value AS `defaultValue`
```

### 问题2：字段不存在
**原因**：SQL查询了数据库表中不存在的字段 `bit_length` 和 `hardware_order`

**修复**：删除不存在的字段，使用实际存在的字段
```xml
-- 删除：pd.bit_length AS bitLength
-- 删除：pd.hardware_order AS hardwareOrder
-- 添加：pd.bit_width_type AS bitWidthType
-- 添加：pd.sort_order AS sortOrder
```

**修复文件**：
- `RuoYi-Vue/ruoyi-system/src/main/resources/mapper/system/SysBasebandMacroParamMapper.xml`

**修复时间**：2025-12-09 22:40

## 🚀 立即生效步骤

### 方法1：重启后端服务（推荐）

#### Windows环境
```bash
# 1. 停止当前运行的后端服务（Ctrl+C）

# 2. 重新编译并启动
cd RuoYi-Vue/ruoyi-admin
mvn clean package -DskipTests
mvn spring-boot:run
```

#### 或者使用IDE
1. 停止当前运行的Spring Boot应用
2. 重新运行 `RuoYiApplication.java`

### 方法2：热部署（如果配置了）
如果项目配置了Spring Boot DevTools，只需：
1. 保存修改的文件
2. 等待自动重启（约5-10秒）

## 🧪 测试步骤

### 1. 验证后端服务
访问：http://localhost:8080/
确认服务正常启动

### 2. 测试宏管理功能
1. 登录系统
2. 进入：**基带监控 > 宏管理**
3. 点击任意宏的"配置参数"按钮
4. 应该能正常打开参数配置对话框

### 3. 测试参数配置
1. 在参数配置对话框中点击"添加参数"
2. 选择一些参数
3. 为参数设置值
4. 点击"保存"
5. 应该提示"参数配置保存成功"

### 4. 验证数据库
```sql
-- 查看宏参数是否保存成功
SELECT * FROM sys_baseband_macro_param;

-- 查看参数详情（关联查询）
SELECT 
    mp.id,
    mp.macro_id,
    mp.param_id,
    mp.param_value,
    pd.param_name,
    pd.param_code
FROM sys_baseband_macro_param mp
LEFT JOIN sys_baseband_param_def pd ON mp.param_id = pd.param_id;
```

## 📋 完整功能测试清单

- [ ] 宏列表正常显示
- [ ] 点击"配置参数"不报错
- [ ] 参数配置对话框正常打开
- [ ] 显示宏的基本信息（名称、类型等）
- [ ] 点击"添加参数"能打开参数选择对话框
- [ ] 参数列表正常显示（包含参数名称、类型、取值范围等）
- [ ] 可以选择多个参数
- [ ] 可以为参数设置值
- [ ] 可以删除已添加的参数
- [ ] 点击"保存"能成功保存参数配置
- [ ] 再次打开"配置参数"能看到之前保存的参数

## 🔍 故障排查

### 问题1：重启后仍然报错
**检查**：
1. 确认修改的文件是否正确
2. 查看文件路径：`RuoYi-Vue/ruoyi-system/src/main/resources/mapper/system/SysBasebandMacroParamMapper.xml`
3. 确认反引号是否正确添加：
```xml
pd.`max_value` AS maxValue,
pd.`default_value` AS defaultValue
```

### 问题2：编译失败
**检查**：
```bash
# 清理并重新编译
cd RuoYi-Vue
mvn clean
mvn compile
```

### 问题3：参数列表为空
**检查**：
```sql
-- 确认参数定义表有数据
SELECT COUNT(*) FROM sys_baseband_param_def;

-- 如果为空，需要先添加参数定义
```

### 问题4：保存参数后查询不到
**检查**：
```sql
-- 查看是否有数据
SELECT * FROM sys_baseband_macro_param WHERE macro_id = 1;

-- 检查外键关联
SELECT 
    mp.*,
    pd.param_name
FROM sys_baseband_macro_param mp
LEFT JOIN sys_baseband_param_def pd ON mp.param_id = pd.param_id
WHERE mp.macro_id = 1;
```

## 📊 预期结果

### 配置参数对话框应该显示：
```
┌─────────────────────────────────────────────────┐
│ 配置宏参数                                    ×  │
├─────────────────────────────────────────────────┤
│ 宏名称：编码标准配置                             │
│ 单元类型：编码                                   │
│ 模式类型：KSA                                    │
├─────────────────────────────────────────────────┤
│ 参数配置                                         │
│                                                  │
│ [+ 添加参数]                                     │
│                                                  │
│ ┌──────────────────────────────────────────┐   │
│ │ 参数名称 │ 类型 │ 取值范围 │ 参数值 │ 操作│   │
│ ├──────────────────────────────────────────┤   │
│ │ 码率     │ UINT │ 1~1000  │ [100]  │删除│   │
│ │ 编码方式 │ ENUM │ LDPC... │ [LDPC] │删除│   │
│ └──────────────────────────────────────────┘   │
│                                                  │
│                          [保存] [取消]           │
└─────────────────────────────────────────────────┘
```

## 🎯 下一步工作

修复完成后，可以继续实现：

### 1. 单元创建时应用宏参数
- 修改单元创建接口
- 自动将宏参数写入 `sys_baseband_param_value` 表

### 2. 参数自动下发
- 创建参数下发服务
- 通过组播发送参数到硬件

### 3. 完善错误处理
- 参数值验证
- 下发状态反馈
- 异常日志记录

## 📞 相关文档

- 功能设计：`宏管理功能设计文档.md`
- 使用指南：`宏管理快速使用指南.md`
- 实现清单：`宏管理功能实现清单.md`
- 部署说明：`宏管理功能部署完成.md`
- 前端调试：`宏管理前端调试指南.md`
- 问题排查：`宏管理问题排查和修复指南.md`

---

**修复时间**：2025-12-09  
**状态**：✅ SQL已修复，等待重启后端服务测试  
**优先级**：高 - 核心功能

