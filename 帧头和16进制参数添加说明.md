# 帧头和16进制参数添加说明

## 功能概述

为四个单元类型（编码、调制、解调、译码）添加：
1. **帧头标志**：固定值0x5555（2字节）
2. **起始地址**：参数起始地址（4字节）
3. **16进制类型参数**：每个单元类型4个16进制参数

## 新增内容

### 1. 帧头标志和起始地址

每个单元类型都添加了以下两个参数（hardware_order = 1, 2）：

| 参数代码 | 参数名称 | 值类型 | 默认值 | 位宽 | 说明 |
|---------|---------|--------|--------|------|------|
| FRAME_HEADER | 帧头标志 | HEX | 0x5555 | 16位 | 固定值，用于帧同步 |
| START_ADDR | 起始地址 | HEX | 0x00000000 | 32位 | 参数起始地址 |

### 2. 编码单元16进制参数

| 参数代码 | 参数名称 | 默认值 | 位宽 | 说明 |
|---------|---------|--------|------|------|
| ENC_SYNC_WORD_HEX | 同步字(HEX) | 0x1ACFFC1D | 32位 | 帧同步字 |
| ENC_SCRAMBLER_SEED | 扰码种子 | 0xFFFF | 16位 | 扰码器初始种子 |
| ENC_CRC_POLY | CRC多项式 | 0x04C11DB7 | 32位 | CRC32多项式 |
| ENC_MASK_PATTERN | 掩码模式 | 0xAA | 8位 | 数据掩码 |

### 3. 调制单元16进制参数

| 参数代码 | 参数名称 | 默认值 | 位宽 | 说明 |
|---------|---------|--------|------|------|
| MOD_PILOT_PATTERN | 导频图案 | 0x12345678 | 32位 | 导频插入模式 |
| MOD_SCRAMBLER_INIT | 扰码初值 | 0x0001 | 16位 | 扰码器初始化值 |
| MOD_SYNC_MARKER | 同步标记 | 0x47 | 8位 | TS同步字节 |
| MOD_FRAME_ID | 帧标识 | 0xABCD | 16位 | 帧ID标识 |

### 4. 解调单元16进制参数

| 参数代码 | 参数名称 | 默认值 | 位宽 | 说明 |
|---------|---------|--------|------|------|
| DEMOD_SYNC_WORD | 同步字 | 0x1ACFFC1D | 32位 | 帧同步检测字 |
| DEMOD_DESCRAMBLER_SEED | 解扰种子 | 0xFFFF | 16位 | 解扰码器种子 |
| DEMOD_PILOT_MASK | 导频掩码 | 0xFFFFFFFF | 32位 | 导频提取掩码 |
| DEMOD_CARRIER_OFFSET | 载波偏移 | 0x0000 | 16位 | 载波频偏补偿 |

### 5. 译码单元16进制参数

| 参数代码 | 参数名称 | 默认值 | 位宽 | 说明 |
|---------|---------|--------|------|------|
| DEC_SYNC_PATTERN | 同步模式 | 0x1ACFFC1D | 32位 | 帧同步检测模式 |
| DEC_DESCRAMBLER_INIT | 解扰初值 | 0xFFFF | 16位 | 解扰码器初始值 |
| DEC_CRC_CHECK | CRC校验值 | 0x04C11DB7 | 32位 | CRC校验多项式 |
| DEC_ERROR_MASK | 错误掩码 | 0x00 | 8位 | 错误检测掩码 |

## 前端支持

### 1. 新增HEX值类型

在参数配置页面中，HEX类型参数显示为：
- **类型标签**：红色"16进制"标签
- **输入控件**：带"0x"前缀的文本输入框
- **字体**：等宽字体（Courier New）
- **验证**：自动验证16进制格式

### 2. 输入格式

支持以下输入格式：
- `5555` - 自动添加0x前缀
- `0x5555` - 标准格式
- `0X5555` - 大写X也支持
- 自动转换为大写显示

### 3. 显示效果

```
帧头标志: [0x] [5555    ]
起始地址: [0x] [00000000]
同步字:   [0x] [1ACFFC1D]
```

## 部署步骤

### 第一步：执行数据库脚本

**Windows环境：**
```bash
cd RuoYi-Vue\sql
add_frame_header_and_hex_params.bat
```

**手动执行：**
```bash
mysql -u bbe -p ry-vue < add_frame_header_and_hex_params.sql
```

### 第二步：验证数据

执行后会显示：
```
帧头和16进制参数添加完成

unit_type    | param_count
-------------|------------
ENCODE       | 34
MODULATE     | 34
DEMODULATE   | 34
DECODE       | 34
```

### 第三步：刷新前端

强制刷新浏览器（Ctrl+F5）

### 第四步：测试功能

1. 进入基带单元列表
2. 选择任意单元，点击"配置"
3. 应该能看到：
   - 最前面的两个参数：帧头标志、起始地址
   - 显示为红色"16进制"标签
   - 输入框带"0x"前缀
   - 可以输入16进制值

## 数据变更说明

### 1. hardware_order调整

所有原有参数的 `hardware_order` 都增加了2，为帧头和起始地址腾出位置：
- 原 hardware_order = 10 → 新 hardware_order = 12
- 原 hardware_order = 20 → 新 hardware_order = 22
- 以此类推...

### 2. 参数顺序

新的参数顺序：
1. **hardware_order = 1**: 帧头标志（0x5555）
2. **hardware_order = 2**: 起始地址（0x00000000）
3. **hardware_order = 12+**: 原有参数（顺序不变）
4. **hardware_order = 115+**: 新增16进制参数

## 使用场景

### 1. 帧头标志

用于硬件识别参数帧的开始：
```
[0x5555] [起始地址] [参数1] [参数2] ...
```

### 2. 起始地址

指示参数在硬件中的存储地址：
- 编码单元：0x00000000
- 调制单元：0x00001000
- 解调单元：0x00002000
- 译码单元：0x00003000

### 3. 16进制参数

用于配置硬件寄存器、掩码、多项式等：
- **同步字**：帧同步检测
- **扰码种子**：数据加扰/解扰
- **CRC多项式**：错误检测
- **掩码模式**：数据处理

## 注意事项

1. **帧头固定值**：帧头标志固定为0x5555，不建议修改
2. **地址对齐**：起始地址应该4字节对齐
3. **16进制输入**：输入时可以省略0x前缀，系统会自动添加
4. **大小写**：系统会自动转换为大写显示
5. **范围检查**：输入值不能超过对应位宽的最大值

## 回滚方案

如果需要回滚：

```sql
-- 删除新增的参数
DELETE FROM sys_baseband_param_def 
WHERE param_code IN (
  'FRAME_HEADER', 'START_ADDR',
  'ENC_SYNC_WORD_HEX', 'ENC_SCRAMBLER_SEED', 'ENC_CRC_POLY', 'ENC_MASK_PATTERN',
  'MOD_PILOT_PATTERN', 'MOD_SCRAMBLER_INIT', 'MOD_SYNC_MARKER', 'MOD_FRAME_ID',
  'DEMOD_SYNC_WORD', 'DEMOD_DESCRAMBLER_SEED', 'DEMOD_PILOT_MASK', 'DEMOD_CARRIER_OFFSET',
  'DEC_SYNC_PATTERN', 'DEC_DESCRAMBLER_INIT', 'DEC_CRC_CHECK', 'DEC_ERROR_MASK'
);

-- 恢复原有参数的hardware_order
UPDATE sys_baseband_param_def 
SET hardware_order = hardware_order - 2 
WHERE unit_type IN ('ENCODE', 'MODULATE', 'DEMODULATE', 'DECODE')
  AND hardware_order > 2;
```

## 相关文件

### 数据库脚本
- `RuoYi-Vue/sql/add_frame_header_and_hex_params.sql` - SQL脚本
- `RuoYi-Vue/sql/add_frame_header_and_hex_params.bat` - 批处理文件

### 前端文件
- `RuoYi-Vue3/src/views/system/baseband/paramValue/index.vue` - 参数配置页面

### 文档
- `帧头和16进制参数添加说明.md` - 本文件

## 更新日期
2024-12-02
