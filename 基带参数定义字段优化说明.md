# 基带参数定义字段优化说明

## 优化概述

根据实际硬件下发需求，对基带参数定义模块的字段进行了优化调整，使其更符合实际使用场景。

## 主要修改内容

### 1. 缩放倍数 → 量化单位

**修改前**：
- 字段名：`scale_factor`（缩放倍数）
- 用途：浮点转无符号整数时的缩放倍数
- 类型：整数

**修改后**：
- 字段名：`quantization_unit`（量化单位）
- 用途：下发给硬件时需要除以此值
- 类型：整数
- 默认值：1

**修改原因**：
- 更准确地描述字段用途
- 明确下发硬件时的处理逻辑：`硬件值 = 配置值 / 量化单位`
- 例如：配置值为100，量化单位为10，则下发给硬件的值为10

**使用示例**：
```
配置值：100
量化单位：10
下发值：100 / 10 = 10

配置值：3.14
量化单位：100
下发值：3.14 / 100 = 0.0314
```

### 2. 位宽 → 位宽类型（下拉框）

**修改前**：
- 字段名：`bit_length`（位宽）
- 类型：整数（如：8, 16, 32）
- 输入方式：数字输入框

**修改后**：
- 字段名：`bit_width_type`（位宽类型）
- 类型：字符串枚举
- 输入方式：下拉选择框
- 可选值：
  - **U8**：8位无符号数（0 ~ 255）
  - **U16**：16位无符号数（0 ~ 65535）
  - **U32**：32位无符号数（0 ~ 4294967295）
  - **I8**：8位有符号数（-128 ~ 127）
  - **I16**：16位有符号数（-32768 ~ 32767）
  - **I32**：32位有符号数（-2147483648 ~ 2147483647）

**修改原因**：
- 明确区分有符号和无符号类型
- 避免输入错误的位宽值
- 便于后端根据类型进行数据验证和转换
- 更符合硬件接口规范

**数据范围对照表**：

| 位宽类型 | 位数 | 符号 | 最小值 | 最大值 |
|---------|------|------|--------|--------|
| U8 | 8 | 无符号 | 0 | 255 |
| U16 | 16 | 无符号 | 0 | 65,535 |
| U32 | 32 | 无符号 | 0 | 4,294,967,295 |
| I8 | 8 | 有符号 | -128 | 127 |
| I16 | 16 | 有符号 | -32,768 | 32,767 |
| I32 | 32 | 有符号 | -2,147,483,648 | 2,147,483,647 |

### 3. 删除硬件顺序字段

**删除字段**：
- 字段名：`hardware_order`（硬件顺序）
- 类型：整数

**删除原因**：
- 硬件顺序在实际使用中不需要手动维护
- 参数的顺序可以通过参数ID（param_id）自然排序
- 简化参数定义，减少维护成本

**影响**：
- 列表排序改为按 `param_id` 排序
- 删除表单中的"硬件顺序"输入项
- 删除表格中的"硬件顺序"列

### 4. 新增步进值字段

**新增字段**：
- 字段名：`step_value`（步进值）
- 类型：DECIMAL(10,2)
- 默认值：1.00

**用途**：
- 定义参数调整时的最小步进单位
- 用于前端输入控件的步进设置
- 提高参数配置的精确度和用户体验

**使用场景**：
1. **整数参数**：步进值为1，每次增减1
2. **浮点参数**：步进值为0.01，每次增减0.01
3. **特殊参数**：步进值为0.5，每次增减0.5

**示例**：
```javascript
// 前端输入控件
<el-input-number 
  v-model="paramValue" 
  :step="param.stepValue"  // 使用参数定义的步进值
  :min="param.minValue" 
  :max="param.maxValue" 
/>
```

## 数据库变更

### SQL迁移脚本

文件：`RuoYi-Vue/sql/update_param_def_fields.sql`

```sql
-- 删除硬件顺序字段
ALTER TABLE sys_baseband_param_def DROP COLUMN hardware_order;

-- 修改缩放倍数字段为量化单位
ALTER TABLE sys_baseband_param_def 
CHANGE COLUMN scale_factor quantization_unit INT DEFAULT 1 
COMMENT '量化单位（下发给硬件时需要除以它）';

-- 修改位宽字段为位宽类型
ALTER TABLE sys_baseband_param_def 
CHANGE COLUMN bit_length bit_width_type VARCHAR(10) DEFAULT 'U16' 
COMMENT '位宽类型：U8/U16/U32/I8/I16/I32';

-- 添加步进值字段
ALTER TABLE sys_baseband_param_def 
ADD COLUMN step_value DECIMAL(10,2) DEFAULT 1.00 
COMMENT '步进值' AFTER bit_width_type;
```

### 数据迁移注意事项

1. **备份数据**：执行SQL前先备份原表
2. **位宽类型转换**：原来的数字位宽需要转换为类型字符串
   - 8 → U8
   - 16 → U16
   - 32 → U32
3. **步进值初始化**：所有参数的步进值默认为1.00
4. **验证数据**：执行后检查数据是否正确

## 后端修改

### 1. 实体类修改

**文件**：`RuoYi-Vue/ruoyi-system/src/main/java/com/ruoyi/system/domain/SysBasebandParamDef.java`

```java
// 删除
private Integer scaleFactor;
private Integer bitLength;
private Integer hardwareOrder;

// 新增
private Integer quantizationUnit;  // 量化单位
private String bitWidthType;       // 位宽类型
private BigDecimal stepValue;      // 步进值
```

### 2. Mapper XML修改

**文件**：`RuoYi-Vue/ruoyi-system/src/main/resources/mapper/system/SysBasebandParamDefMapper.xml`

- 更新 resultMap 字段映射
- 更新 SQL 查询字段
- 更新插入和更新语句
- 修改排序字段：`hardware_order` → `param_id`

## 前端修改

### 1. 表格列修改

**文件**：`RuoYi-Vue3/src/views/system/baseband/paramDef/index.vue`

**修改前**：
```vue
<el-table-column label="硬件顺序" prop="hardwareOrder" />
<el-table-column label="位宽" prop="bitLength" />
<el-table-column label="缩放" prop="scaleFactor" />
```

**修改后**：
```vue
<el-table-column label="位宽类型" prop="bitWidthType" />
<el-table-column label="量化单位" prop="quantizationUnit" />
<el-table-column label="步进" prop="stepValue" />
```

### 2. 表单修改

**位宽类型下拉框**：
```vue
<el-form-item label="位宽类型" prop="bitWidthType">
  <el-select v-model="form.bitWidthType">
    <el-option label="U8 (8位无符号)" value="U8" />
    <el-option label="U16 (16位无符号)" value="U16" />
    <el-option label="U32 (32位无符号)" value="U32" />
    <el-option label="I8 (8位有符号)" value="I8" />
    <el-option label="I16 (16位有符号)" value="I16" />
    <el-option label="I32 (32位有符号)" value="I32" />
  </el-select>
</el-form-item>
```

**量化单位输入框**：
```vue
<el-form-item label="量化单位" prop="quantizationUnit">
  <el-input-number v-model="form.quantizationUnit" :min="1" />
  <div class="hint">下发给硬件时需要除以此值</div>
</el-form-item>
```

**步进值输入框**：
```vue
<el-form-item label="步进值" prop="stepValue">
  <el-input-number 
    v-model="form.stepValue" 
    :min="0" 
    :step="0.01" 
    :precision="2" 
  />
</el-form-item>
```

## 使用示例

### 示例1：定义一个温度参数

```
参数名称：工作温度
值类型：FLOAT
最小值：-40
最大值：85
量化单位：10
位宽类型：I16
步进值：0.5
默认值：25

说明：
- 配置范围：-40°C ~ 85°C
- 步进：0.5°C
- 下发硬件：配置值 / 10
  例如：配置25°C，下发值为2.5
```

### 示例2：定义一个功率参数

```
参数名称：发射功率
值类型：UINT
最小值：0
最大值：100
量化单位：1
位宽类型：U8
步进值：1
默认值：50

说明：
- 配置范围：0 ~ 100
- 步进：1
- 下发硬件：配置值 / 1 = 配置值
  例如：配置50，下发值为50
```

### 示例3：定义一个频率参数

```
参数名称：载波频率
值类型：FLOAT
最小值：0
最大值：6000
量化单位：100
位宽类型：U16
步进值：0.01
默认值：2400

说明：
- 配置范围：0 ~ 6000 MHz
- 步进：0.01 MHz
- 下发硬件：配置值 / 100
  例如：配置2400MHz，下发值为24
```

## 部署步骤

### 1. 备份数据库

```bash
mysqldump -u root -p ry-vue sys_baseband_param_def > backup_param_def_$(date +%Y%m%d).sql
```

### 2. 执行SQL迁移

```bash
mysql -u root -p ry-vue < RuoYi-Vue/sql/update_param_def_fields.sql
```

### 3. 重新编译后端

```bash
cd RuoYi-Vue
mvn clean package
```

### 4. 重启后端服务

```bash
# 停止旧服务
# 启动新服务
```

### 5. 清除前端缓存

- 清除浏览器缓存
- 重新登录系统

### 6. 验证功能

1. 进入"系统管理 > 基带监控 > 参数定义"
2. 查看表格列是否正确显示
3. 新增参数，测试位宽类型下拉框
4. 修改参数，测试量化单位和步进值
5. 保存后查看数据库，验证字段值

## 注意事项

1. **数据迁移**：执行SQL前务必备份数据
2. **位宽类型**：需要手动更新现有数据的位宽类型
3. **量化单位**：默认值为1，表示不进行量化
4. **步进值**：默认值为1.00，可根据实际需要调整
5. **兼容性**：确保前后端同步更新，避免字段不匹配

## 优势总结

1. **更清晰的语义**：量化单位比缩放倍数更准确
2. **类型安全**：位宽类型下拉框避免输入错误
3. **简化维护**：删除不必要的硬件顺序字段
4. **用户体验**：步进值提升参数配置的精确度
5. **硬件对接**：明确的位宽类型便于硬件接口实现

## 扩展性

如果将来需要支持更多位宽类型，只需：

1. 在下拉框中添加新选项
2. 更新数据库字段长度（如果需要）
3. 后端添加对应的验证逻辑

例如添加64位类型：
```vue
<el-option label="U64 (64位无符号)" value="U64" />
<el-option label="I64 (64位有符号)" value="I64" />
```
