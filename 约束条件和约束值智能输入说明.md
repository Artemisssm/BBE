# 约束条件和约束值智能输入说明

## 优化概述

根据选择的源参数和目标参数，智能提供约束条件和约束值的输入方式，让配置更加直观和准确。

## 核心功能

### 1. 智能约束条件输入

#### 场景A：源参数是枚举类型
**自动提供下拉选择**

```
源参数：编码方式（枚举类型）
枚举选项：CONV, LDPC, TURBO

约束条件输入：
┌─────────────────────┐
│ == 卷积码 (CONV)  ▼ │  ← 下拉选择
│ == LDPC码 (LDPC)    │
│ == Turbo码 (TURBO)  │
└─────────────────────┘
```

#### 场景B：源参数是数值类型
**提供输入框**

```
源参数：符号率（整数类型）
范围：1 ~ 100

约束条件输入：
┌─────────────────────┐
│ 当源参数 [>=10    ] │  ← 手动输入
└─────────────────────┘

提示：范围：1 ~ 100
```

### 2. 智能约束值输入

#### 场景A：值范围约束
**提供双数字输入框**

```
目标参数：编码码率（浮点类型）
范围：0.33 ~ 0.95

约束值输入：
┌─────────────────────────┐
│ [0.5] ~ [0.8]           │  ← 两个数字输入框
└─────────────────────────┘

自动生成：0.5,0.8
```

#### 场景B：固定值约束
**提供单数字输入框**

```
目标参数：编码码率（浮点类型）
范围：0.33 ~ 0.95

约束值输入：
┌─────────────────────────┐
│ [0.75]                  │  ← 单个数字输入框
└─────────────────────────┘

自动生成：0.75
```

#### 场景C：枚举限制约束
**提供多选下拉框**

```
目标参数：编码码率（枚举类型）
枚举选项：0.33, 0.5, 0.67, 0.75, 0.8

约束值输入：
┌─────────────────────────┐
│ [0.5, 0.67, 0.75]     ▼ │  ← 多选下拉
│ ☑ 0.5                   │
│ ☑ 0.67                  │
│ ☑ 0.75                  │
│ ☐ 0.8                   │
└─────────────────────────┘

自动生成：0.5,0.67,0.75
```

## 详细示例

### 示例1：编码方式影响码率范围

**配置步骤**：

1. **选择源参数**
   ```
   源单元类型：编码单元
   源参数：编码方式 (ENC_CODE_TYPE)
   
   → 系统识别：枚举类型
   → 枚举选项：CONV, LDPC, TURBO
   ```

2. **选择目标参数**
   ```
   目标单元类型：编码单元
   目标参数：编码码率 (ENC_CODE_RATE)
   
   → 系统识别：浮点类型
   → 范围：0.33 ~ 0.95
   ```

3. **选择约束类型**
   ```
   约束类型：值范围约束
   ```

4. **配置约束条件**
   ```
   约束条件：[下拉选择]
   ┌─────────────────────┐
   │ == 卷积码 (CONV)  ✓ │  ← 选择
   └─────────────────────┘
   
   自动生成：==CONV
   ```

5. **配置约束值**
   ```
   约束值：[范围输入]
   最小值：[0.5]
   最大值：[0.8]
   
   自动生成：0.5,0.8
   ```

**最终效果**：
```
当编码方式 == CONV 时，码率范围为 0.5 ~ 0.8
```

### 示例2：ACM启用时码率固定

**配置步骤**：

1. **选择源参数**
   ```
   源参数：ACM使能 (ACM_ENABLE)
   
   → 系统识别：枚举类型
   → 枚举选项：0=关, 1=开
   ```

2. **选择目标参数**
   ```
   目标参数：编码码率 (ENC_CODE_RATE)
   
   → 系统识别：浮点类型
   → 范围：0.33 ~ 0.95
   ```

3. **选择约束类型**
   ```
   约束类型：固定值约束
   ```

4. **配置约束条件**
   ```
   约束条件：[下拉选择]
   ┌─────────────────────┐
   │ == 开 (1)         ✓ │  ← 选择
   └─────────────────────┘
   
   自动生成：==1
   ```

5. **配置约束值**
   ```
   约束值：[单值输入]
   固定值：[0.75]
   
   自动生成：0.75
   ```

**最终效果**：
```
当ACM使能 == 1 时，码率固定为 0.75
```

### 示例3：编码方式限制码率枚举

**配置步骤**：

1. **选择源参数**
   ```
   源参数：编码方式 (ENC_CODE_TYPE)
   
   → 系统识别：枚举类型
   ```

2. **选择目标参数**
   ```
   目标参数：编码码率 (ENC_CODE_RATE)
   
   → 系统识别：枚举类型
   → 枚举选项：0.33, 0.5, 0.67, 0.75, 0.8
   ```

3. **选择约束类型**
   ```
   约束类型：枚举限制约束
   ```

4. **配置约束条件**
   ```
   约束条件：[下拉选择]
   == 卷积码 (CONV)
   ```

5. **配置约束值**
   ```
   约束值：[多选下拉]
   ┌─────────────────────┐
   │ [0.5, 0.67, 0.75] ▼ │
   │ ☐ 0.33              │
   │ ☑ 0.5               │  ← 选中
   │ ☑ 0.67              │  ← 选中
   │ ☑ 0.75              │  ← 选中
   │ ☐ 0.8               │
   └─────────────────────┘
   
   自动生成：0.5,0.67,0.75
   ```

**最终效果**：
```
当编码方式 == CONV 时，码率只能选择：0.5, 0.67, 0.75
```

## 参数信息提示

### 源参数信息
```
源参数类型：枚举 | 范围：- 
源参数类型：整数 | 范围：1 ~ 100
源参数类型：浮点 | 范围：0.33 ~ 0.95
```

### 目标参数信息
```
目标参数类型：枚举 | 范围：-
目标参数类型：整数 | 范围：1 ~ 100
目标参数类型：浮点 | 范围：0.33 ~ 0.95
```

## 输入控件对应表

| 约束类型 | 目标参数类型 | 约束值输入控件 | 格式 |
|----------|--------------|----------------|------|
| 值范围约束 | 整数/浮点 | 双数字输入框 | `最小值,最大值` |
| 固定值约束 | 整数/浮点 | 单数字输入框 | `固定值` |
| 枚举限制约束 | 枚举 | 多选下拉框 | `值1,值2,值3` |
| 禁用约束 | 任意 | 普通输入框 | 留空 |
| 值同步约束 | 任意 | 普通输入框 | 留空 |

## 数据验证

### 范围验证
```javascript
// 自动限制输入范围
<el-input-number 
  :min="targetParam.minValue"
  :max="targetParam.maxValue"
/>
```

### 精度验证
```javascript
// 根据参数类型设置精度
<el-input-number 
  :precision="targetParam.valueType === 'FLOAT' ? 2 : 0"
/>
```

### 格式验证
```javascript
// 自动生成正确格式
范围：rangeMin + ',' + rangeMax
枚举：selectedValues.join(',')
```

## 优势总结

### 1. 智能识别
- ✅ 自动识别参数类型
- ✅ 自动识别参数范围
- ✅ 自动识别枚举选项

### 2. 精确输入
- ✅ 枚举类型提供下拉选择
- ✅ 数值类型提供数字输入框
- ✅ 自动限制输入范围

### 3. 格式正确
- ✅ 自动生成正确格式
- ✅ 避免手动输入错误
- ✅ 减少验证失败

### 4. 用户友好
- ✅ 直观的输入方式
- ✅ 清晰的参数信息
- ✅ 实时的格式提示

## 技术实现

### 参数信息获取
```javascript
function getSourceParamInfo() {
  return paramDefList.value.find(p => p.paramCode === form.value.sourceParamName)
}

function getTargetParamInfo() {
  return paramDefList.value.find(p => p.paramCode === form.value.targetParamName)
}
```

### 枚举选项解析
```javascript
function getSourceParamEnumOptions() {
  const param = getSourceParamInfo()
  if (!param || !param.enumOptions) return {}
  return JSON.parse(param.enumOptions)
}
```

### 约束值生成
```javascript
// 范围约束
function updateConstraintValue() {
  form.value.constraintValue = `${rangeMin.value},${rangeMax.value}`
}

// 枚举限制
function updateEnumConstraintValue() {
  form.value.constraintValue = selectedEnumValues.value.join(',')
}
```

## 部署说明

### 前端更新
✅ 已完成，刷新浏览器即可

### 无需后端修改
✅ 纯前端优化
✅ 不影响现有数据
✅ 完全向后兼容

## 总结

✅ 智能识别参数类型和范围
✅ 提供对应的输入控件
✅ 自动生成正确格式
✅ 减少配置错误
✅ 提升用户体验

现在配置约束规则更加直观和准确了！
